define(["require","jquery","libs/general/ConfigurationManager/ConfigurationManager","libs/general/Validator","libs/general/Swipe/SwipeManager","libs/NCarousel/transitions/BasicTransition","libs/NCarousel/transitions/CycleTransition","libs/NCarousel/transitions/FadeTransition","libs/NCarousel/transitions/SlideTransition","libs/NCarousel/transitions/SmoothTransition"],function(e){var t=e("jquery"),n=e("libs/general/ConfigurationManager/ConfigurationManager"),r=e("libs/general/Validator"),i=e("libs/general/Swipe/SwipeManager"),s=e("libs/NCarousel/transitions/BasicTransition"),o=e("libs/NCarousel/transitions/CycleTransition"),u=e("libs/NCarousel/transitions/FadeTransition"),a=e("libs/NCarousel/transitions/SlideTransition"),f=e("libs/NCarousel/transitions/SmoothTransition"),l=function(e,t){this.constructor(e,t)};return l.prototype={_carouselConfiguration:null,_transitionObject:null,_swipeManager:null,_domReferences:null,_state:null,_autoPlayProgressEvents:null,_onSlideChangeEvents:null,_containerSize:null,_slideSize:null,_carouselReversed:!1,_numberOfSlides:0,_virtualNumberOfSlides:0,_smoothTransitionFPS:60,_autoPlayProgressFPS:30,constructor:function(e,t){var n=e.data("NCarousel");if(n&&n instanceof l)return!1;t==undefined&&(t={}),this._state={previousAutoPlaySlideChangeTime:null,disableCarousel:!1,disableAutoPlay:!1,currentSlideNumber:0,changingSlide:!1,slideOffset:0,autoPlayInterval:null},this._initConfiguration(t);if(!this._carouselConfiguration.isOptionValid("direction")){if(t.direction=="right"||t.direction=="down")this._carouselReversed=!0;t.direction=="left"||t.direction=="right"?this.config("direction","horizontal"):(t.direction=="up"||t.direction=="down")&&this.config("direction","vertical")}t.onSlideChange!=null&&(typeof t.onSlideChange=="function"&&(t.onSlideChange=[t.onSlideChange]),this._onSlideChangeEvents=t.onSlideChange),t.onAutoPlayProgress!==undefined&&(typeof t.autoPlayProgress=="function"&&(t.autoPlayProgress=[t.autoPlayProgress]),this._autoPlayProgressEvents=t.autoPlayProgress),this._storeReferences(e),this._calculateNumberOfSlides();if(this._numberOfSlides==0)return;this._bindEvents(),this._attachClasses(),this.resizeCarouselList(),this._initTransition(),this.resizeCarouselList(),this.updateNavigation(),this.updateIndicators(),this.config("autoPlay")&&this.startAutoPlay(),this.getDOMReference("carouselContainer").find(".carousel-loading").hide(),this.state("carouselInitialized",!0),e.data("NCarousel",this)},_reinitializeCarousel:function(){this._storeReferences(this.getDOMReference("carouselWrapper")),this._calculateNumberOfSlides(),this._attachClasses(),this._transitionObject.reinitialize(),this.resizeCarouselList(),this.updateNavigation(),this.updateIndicators(),this.changeSlide(0,!0)},_initConfiguration:function(e){this._carouselConfiguration=new n,this._carouselConfiguration.addOption("direction").setAllowedValues(["vertical","horizontal"]).setDefaultValue("horizontal"),this._carouselConfiguration.addOption("transition").setAllowedValues(["basic","cycle","fade","slide","smooth"]).setDefaultValue("basic"),this._carouselConfiguration.addOption("autoPlay").setValidationType(r.VALIDATION_TYPES.BOOL).setDefaultValue(!0),this._carouselConfiguration.addOption("pauseOnHover").setValidationType(r.VALIDATION_TYPES.BOOL).setDefaultValue(!0),this._carouselConfiguration.addOption("pauseOnExit").setValidationType(r.VALIDATION_TYPES.BOOL).setDefaultValue(!0),this._carouselConfiguration.addOption("advanceOnClick").setValidationType(r.VALIDATION_TYPES.BOOL).setDefaultValue(!1),this._carouselConfiguration.addOption("showAllOnClick").setValidationType(r.VALIDATION_TYPES.BOOL).setDefaultValue(!1),this._carouselConfiguration.addOption("showAllTransitionSpeed").setValidationType(r.VALIDATION_TYPES.UINT).setDefaultValue(500),this._carouselConfiguration.addOption("autoPlayStep").setValidationType(r.VALIDATION_TYPES.INT).setDefaultValue(1),this._carouselConfiguration.addOption("scrollSpeed").setValidationType(r.VALIDATION_TYPES.UINT).setDefaultValue(1e3),this._carouselConfiguration.addOption("autoPlayDelay").setValidationType(r.VALIDATION_TYPES.UINT).setDefaultValue(3e3),this._carouselConfiguration.addOption("fadeTransitionSpeed").setValidationType(r.VALIDATION_TYPES.UINT).setDefaultValue(1e3),this._carouselConfiguration.addOption("smoothTransitionSpeed").setValidationType(r.VALIDATION_TYPES.UINT).setDefaultValue(100),this._carouselConfiguration.addOption("smoothCycle").setValidationType(r.VALIDATION_TYPES.BOOL).setDefaultValue(!0),this._carouselConfiguration.addOption("disableControlsOnChange").setValidationType(r.VALIDATION_TYPES.BOOL).setDefaultValue(!0),this._carouselConfiguration.addOption("disableAutoPlayOnUserAction").setValidationType(r.VALIDATION_TYPES.BOOL).setDefaultValue(!0),this._carouselConfiguration.addOption("onSlideChangeEvents").setDefaultValue(null),this._carouselConfiguration.addOption("autoPlayProgressEvents").setDefaultValue(null),this._carouselConfiguration.addOption("allowWrapping").setValidationType(r.VALIDATION_TYPES.BOOL).setDefaultValue(!0),this._carouselConfiguration.addOption("bindSwipeEvents").setValidationType(r.VALIDATION_TYPES.BOOL).setDefaultValue(!1),this._carouselConfiguration.addOption("aspectRatio").setValidationType(r.VALIDATION_TYPES.NUMBER).setDefaultValue(null),this._carouselConfiguration.importConfiguration(e),this._carouselConfiguration.validate()},_storeReferences:function(e){this._DOMReferences={},this._DOMReferences.$carouselWrapper=e,this._DOMReferences.$carouselContainer=this.getDOMReference("carouselWrapper").find(".js-carousel-container").eq(0),this._DOMReferences.$carouselList=this.getDOMReference("carouselContainer").children("ul"),this._DOMReferences.$carouselSlides=this.getDOMReference("carouselList").children("li"),this._DOMReferences.$carouselNav=this.getDOMReference("carouselWrapper").find(".js-carousel-nav")},getDOMReference:function(e){return"$"+e in this._DOMReferences?this._DOMReferences["$"+e]:null},_calculateNumberOfSlides:function(){this._numberOfSlides=this._virtualNumberOfSlides=this.getDOMReference("carouselSlides").size(),this._transitionObject&&(this._virtualNumberOfSlides+=this._transitionObject.getVirtaulNumberOfSlidesModifier())},cloneSlides:function(e){if(this._carouselReversed)for(var t=0;t<e;t++)this.getDOMReference("carouselList").prepend(this.getDOMReference("carouselSlides").get(this._numberOfSlides-t%this._numberOfSlides-1).cloneNode(!0)),this._virtualNumberOfSlides++;else for(var t=0;t<e;t++)this.getDOMReference("carouselList").append(this.getDOMReference("carouselSlides").get(t%this._numberOfSlides).cloneNode(!0)),this._virtualNumberOfSlides++},resizeCarouselList:function(){this._calculateNumberOfSlides();var e=this.getDOMReference("carouselContainer"),t=this.getDOMReference("carouselList"),n=this.getDOMReference("carouselSlides");this.resetSize(e),this.resetSize(t,!0,!1),this.resetSize(n);var i=this._containerSize=this.getSize(e,"inner",!0),s=this._slideSize=this.getSize(n,"outer",!0,!0,!0);n.css("width",s.baseWidth+"px"),this.config("direction")=="horizontal"&&t.css("width",s.width*this._virtualNumberOfSlides+(i.width-i.baseWidth));var o=this.config("aspectRatio");o&&r.validate(o,r.VALIDATION_TYPES.NUMBER)&&(e.css("height",Math.floor(i.baseWidth/o)+"px"),n.css("height",Math.floor(s.baseWidth/o)+"px"))},resetSize:function(e,t,n){t==null&&(t=!0);if(n=null)n=!0;t&&e.css({width:""}),n&&e.css({height:""})},getSize:function(e,t,n,r,i){var s=null,o=null;t=="inner"?(s=e.width(),o=e.height()):(s=e.outerWidth(),o=e.outerHeight());var u=s,a=o;n&&(u+=parseInt(e.css("padding-left"),10)+parseInt(e.css("padding-right"),10),a+=parseInt(e.css("padding-top"),10)+parseInt(e.css("padding-bottom"),10)),r&&(u+=parseInt(e.css("margin-left"),10)+parseInt(e.css("margin-right"),10),a+=parseInt(e.css("margin-top"),10)+parseInt(e.css("margin-bottom"),10)),i&&(u+=parseInt(e.css("border-left-width"),10)+parseInt(e.css("border-right-width"),10),a+=parseInt(e.css("border-top-width"),10)+parseInt(e.css("border-bottom-width"),10));var f={baseWidth:s,baseHeight:o,width:u,height:a};return f},getContainerSize:function(){return this._containerSize},getSlideSize:function(){return this._slideSize},_onUserAction:function(){this.config("disableAutoPlayOnUserAction")&&this.disableAutoPlay()},_onNavigationItemClick:function(e,t){this._onUserAction(),this.moveToSlide(e,{stopAutoPlay:!1})},_onPreviousNextSlideClick:function(e,t){t.preventDefault(),this._onUserAction(),this.moveRelativeToSlide(e)},_onAdvanceSlideClick:function(e){e.preventDefault(),this._onUserAction();var n=t(e.target);if(e.target.tagName!="A"||n.data("events")&&n.data("events").click!==undefined)e.preventDefault(),this.moveRelativeToSlide(1)},_onShowFullSlide:function(e){e.preventDefault();var n=t(e.target),r=this.fullSlideIsVisible(n);r!==!0&&(r.left<0?this._$carouselList.animate({left:this._$carouselList.position().left-r.left},this._showAllTransitionSpeed):this._$carouselList.animate({left:this._$carouselList.position().left+r.right},this._showAllTransitionSpeed))},_bindEvents:function(){this.config("bindSwipeEvents")&&this._bindSwipeEvents();if(this.getDOMReference("carouselNav").size()>0){var e=this.getDOMReference("carouselNav").children().eq(0).children();if(e.size()>0)for(var n=0,r=e.size();n<r;n++)e.eq(n).click(this._onNavigationItemClick.bind(this,n)).mousedown(function(e){e.preventDefault()})}this.getDOMReference("carouselWrapper").find(".js-carousel-previous-slide").click(this._onPreviousNextSlideClick.bind(this,-1)).mousedown(function(e){e.preventDefault()}),this.getDOMReference("carouselWrapper").find(".js-carousel-next-slide").click(this._onPreviousNextSlideClick.bind(this,1)).mousedown(function(e){e.preventDefault()}),this.config("advanceOnClick")&&this.getDOMReference("carouselList").addClass("advance-on-click").on("click","> li",this._onAdvanceSlideClick.bind(this)),this.config("transition")=="smooth"&&this.config("showAllOnClick")&&this.getDOMReference("carouselList").on("click","> li",this._onShowFullSlide.bind(this)),t(window).on("resize",this._onResize.bind(this))},_bindSwipeEvents:function(){var e=this._swipeManager=new i,t=this._swipeManager.addListener(this.getDOMReference("carouselContainer"));t.addEventListener("swipeStart",this.stopAutoPlay.bind(this));var n={swipeType:e.SWIPE_TYPES.LEFT,swipeDistance:100,swipeUnits:e.SWIPE_UNITS.PIXELS,triggerOnlyOnRelease:!1,callback:this._onSwipe.bind(this,1)},r={swipeType:e.SWIPE_TYPES.RIGHT,swipeDistance:100,swipeUnits:e.SWIPE_UNITS.PIXELS,triggerOnlyOnRelease:!1,callback:this._onSwipe.bind(this,-1)};t.addSwipeConfiguration(n).addSwipeConfiguration(r)},_onSwipe:function(e,t){this.moveRelativeToSlide(e)},_onResize:function(){var e=this._windowSizeChanged();e&&(this.resizeCarouselList(),this.resetCurrentSlide(),this.state("windowWidth",e.width),this.state("windowHeight",e.height))},_windowSizeChanged:function(){var e=t(window),n=e.width(),r=e.height();return this.state("windowWidth")!=n||this.state("windowHeight")!=r?{width:n,height:r}:!1},_attachClasses:function(){this.config("direction")=="horizontal"&&this.getDOMReference("carouselWrapper").addClass("carousel-horizontal");var e=this.getDOMReference("carouselList").children("li");e.removeClass(function(e,t){return(t.match(/\bcarousel-item-\S+/g)||[]).join(" ")});for(var t=0,n=e.length;t<n;t++)e.eq(t).addClass("carousel-item").addClass("carousel-item-"+(t+1));if(this._carouselReversed)for(var t=0,n=e.length;t<n;t++)this._$carouselList.prepend(e.get(t));var r=this.getDOMReference("carouselNav");if(r){var i=r.children().children();i.removeClass(function(e,t){return(t.match(/\bcarousel-nav-item-\S+/g)||[]).join(" ")});for(var t=0,n=i.length;t<n;t++)i.eq(t).addClass("carousel-nav-item").addClass("carousel-nav-item-"+(t+1))}this.getDOMReference("carouselContainer").css("position","relative"),this.getDOMReference("carouselList").css("position","relative")},_initTransition:function(){var e=this.config("transition");switch(e){case"basic":this._transitionObject=new s(this);break;case"cycle":this._transitionObject=new o(this);break;case"fade":this._transitionObject=new u(this);break;case"slide":this._transitionObject=new a(this);break;case"smooth":this._transitionObject=new f(this);break;default:throw new Error("No transition defined. Transition specified: "+e)}},config:function(e,t,n){if(t===undefined)return this._carouselConfiguration.getValue(e);n===undefined&&(n=!0);var r=this._carouselConfiguration.setValue(e,t);return n&&this._carouselConfiguration.validate(),r},state:function(e,t){if(t===undefined)return this._state[e];this._state[e]=t},getCurrentSlideNumber:function(){return this.state("currentSlideNumber")},getNumberOfSlides:function(){return this._numberOfSlides},getSlide:function(e){return this.getAllSlides().eq(e)},getAllSlides:function(){return this.getDOMReference("carouselList").find(".carousel-item")},disableCarousel:function(){this.state("disableCarousel",!0)},enableCarousel:function(){this.state("disableCarousel",!1)},resetCurrentSlide:function(){if(!this.state("carouselInitialized"))return;this.moveToSlide(this.state("currentSlideNumber"),null,!0)},moveToSlide:function(e,t,n){if(n){this._transitionObject.triggerTransition(e,t),this.state("currentSlideNumber",e%this._numberOfSlides);return}if(this.state("disableCarousel")==1)return;if(e==this.state("currentSlideNumber"))return;if(this.config("disableControlsOnChange")&&this.state("changingSlide"))return;t===undefined&&(t={}),t.stopAutoPlay==null&&(t.stopAutoPlay=!1),t.scrollSpeed==null&&(t.scrollSpeed=this.config("scrollSpeed")),t.fadeTransitionSpeed==null&&(t.fadeTransitionSpeed=this.config("fadeTransitionSpeed")),t.directionReversed==null&&(t.directionReversed=!1),t.stopAutoPlay&&this.stopAutoPlay();var r=this.state("currentSlideNumber");this.updateAutoPlayProgress(0),this.toggleChangingSlide(!0),this._transitionObject.triggerTransition(e,t),this.state("currentSlideNumber",e%this._numberOfSlides),this.updateNavigation(),this.updateIndicators(),this._triggerSlideChangeEvents(r,t.relativeOffset),this.state("previousAutoPlaySlideChangeTime",(new Date).getTime())},_triggerSlideChangeEvents:function(e,t){e===undefined&&(e=0),t===undefined&&(t=0);if(this._onSlideChangeEvents&&typeof this._onSlideChangeEvents=="object"){var n={previousSlideNumber:e,currentSlideNumber:this.state("currentSlideNumber"),actualSlideNumber:this.state("actualSlideNumber"),relativeOffset:t||null,numberOfSlides:this._numberOfSlides,slideOffset:this.state("slideOffset")};for(var r=0;r<this._onSlideChangeEvents.length;r++)typeof this._onSlideChangeEvents[r]=="function"&&this._onSlideChangeEvents[r](n)}},moveRelativeToSlide:function(e,t){t===undefined&&(t=!0);var n={};n.directionReversed=e<0,n.relativeOffset=e;var r=(this.state("currentSlideNumber")+e)%this._numberOfSlides;r<0&&(r+=this._numberOfSlides);if(this.config("allowWrapping")==0&&(r<this.state("currentSlideNumber")&&e>0||r>this.state("currentSlideNumber")&&e<0))return;this.moveToSlide(r,n)},disableAutoPlay:function(){this.stopAutoPlay(),this.state("disableAutoPlay",!0)},enableAutoPlay:function(){this.state("disableAutoPlay",!1)},_onAutoPlayIntervalDelayReached:function(){var e=(new Date).getTime();if(this.state("changingSlide")){this.state("previousAutoPlaySlideChangeTime",e);return}var t=e-this.state("previousAutoPlaySlideChangeTime");t>=this.config("autoPlayDelay")?(this.updateAutoPlayProgress(1),this.moveRelativeToSlide(this.config("autoPlayStep"),!1)):this.updateAutoPlayProgress(t/this.config("autoPlayDelay"))},startAutoPlay:function(){if(this.state("disableAutoPlay"))return;this.state("previousAutoPlaySlideChangeTime",(new Date).getTime()),this.state("autoPlayInterval",setInterval(this._onAutoPlayIntervalDelayReached.bind(this),1e3/this._autoPlayProgressFPS))},updateAutoPlayProgress:function(e){if(this._autoPlayProgressEvents&&typeof this._autoPlayProgressEvents=="object"){var t={percent:e};for(var n=0;n<this._autoPlayProgressEvents.length;n++)typeof this._autoPlayProgressEvents[n]=="function"&&this._autoPlayProgressEvents[n](t)}},stopAutoPlay:function(){clearInterval(this.state("autoPlayInterval")),this.state("autoPlayInterval",null)},updateNavigation:function(){if(this.getDOMReference("carouselNav").size()>0){var e=this.getDOMReference("carouselNav").children().eq(0).children();e.removeClass("carousel-nav-item-active"),t(e.get(this.state("currentSlideNumber"))).addClass("carousel-nav-item-active")}},changeSlide:function(e,t,n){n==null&&(n={});var r={},i=this.getPositioningData(e);r[i.property]=i.position;var s=n.preventSlideChangeCompleteEvent?null:this._onChangeSlideComplete.bind(this,n);this.getDOMReference("carouselList").stop().animate(r,n.scrollSpeed||0,s),this.state("actualSlideNumber",e),t&&this.state("currentSlideNumber",e)},_onChangeSlideComplete:function(e){this.slideChangeComplete()},slideChangeComplete:function(e){e==null&&(e={}),this.toggleChangingSlide(!1);var t=e.onComplete;t!=null&&typeof t=="function"&&t()},getPositioningData:function(e){var t={property:null,position:null};if(this.config("direction")=="vertical"){var n=this._carouselReversed?-1*this._slideSize.height*(this._virtualNumberOfSlides-e-1):-1*this._slideSize.height*e;t.property="top",t.position=n}else{var r=this._carouselReversed?-1*this._slideSize.width*(this._virtualNumberOfSlides-e):-1*this._slideSize.width*e;t.property="left",t.position=r}return t},toggleChangingSlide:function(e){e===undefined&&(e=!this.state("changingSlide")),e===!0?(this.state("changingSlide",!0),this.config("disableControlsOnChange")&&this.getDOMReference("carouselNav")&&this.getDOMReference("carouselWrapper").addClass("carousel-navigation-disabled")):(this.state("changingSlide",!1),this.config("disableControlsOnChange")&&this.getDOMReference("carouselNav")&&this.getDOMReference("carouselWrapper").removeClass("carousel-navigation-disabled"))},fullSlideIsVisible:function(e){var t=e.parent();if(this.config("direction")=="horizontal"){var n=-1*t.position().left,r=n+t.parent().outerWidth(),i=e.position().left,s=i+e.outerWidth();if(!(i>=n&&s<=r))return{left:i-n,right:r-s}}else if(this.config("direction")=="vertical"){var o=-1*t.position().top,u=o+t.parent().outerHeight(),a=e.position().top,f=a+e.outerHeight();if(!(a>=o&&f<=u))return{top:a-o,bottom:u-f}}return!0},updateIndicators:function(){var e=this.state("actualSlideNumber");this.getDOMReference("carouselWrapper").find(".carousel-slide-number").html(e+1),this.getDOMReference("carouselWrapper").find(".carousel-total-slides").html(this._numberOfSlides),this.getDOMReference("carouselList").children("li").removeClass("carousel-prev-indicator carousel-current-indicator carousel-next-indicator"),this.getDOMReference("carouselList").children("li").eq(e).addClass("carousel-current-indicator"),this.getDOMReference("carouselList").children("li").eq(e).next().addClass("carousel-next-indicator"),this.getDOMReference("carouselList").children("li").eq(e).prev().addClass("carousel-prev-indicator");var t=this.getNumberOfSlides();if(t<2)this._setPreviousSlideButtonEnabledStatus(!1),this._setNextSlideButtonEnabledStatus(!1);else if(!this.config("allowWrapping")){var e=this.state("actualSlideNumber");e==0||e==undefined?(this._setPreviousSlideButtonEnabledStatus(!1),this._setNextSlideButtonEnabledStatus(!0)):e==t-1?(this._setPreviousSlideButtonEnabledStatus(!0),this._setNextSlideButtonEnabledStatus(!1)):(this._setPreviousSlideButtonEnabledStatus(!0),this._setNextSlideButtonEnabledStatus(!0))}},_setPreviousSlideButtonEnabledStatus:function(e){var t=this.getDOMReference("carouselWrapper").find(".js-carousel-previous-slide");this._setNavigationButtonEnabledStatus(t,e)},_setNextSlideButtonEnabledStatus:function(e){var t=this.getDOMReference("carouselWrapper").find(".js-carousel-next-slide");this._setNavigationButtonEnabledStatus(t,e)},_setNavigationButtonEnabledStatus:function(e,t){t?e.removeClass("disabled"):e.addClass("disabled")},command:function(e){if(e==undefined)return!1;var t=e[0];if(typeof t=="string")switch(t){case"startAutoPlay":this.startAutoPlay();return;case"stopAutoPlay":this.stopAutoPlay();return;case"moveRelativeToSlide":var n=1;typeof e[1]=="number"&&(n=e[1]),this.moveRelativeToSlide(n,e[2]);return;case"moveToSlide":typeof e[1]=="number"&&this.moveToSlide(e[1]);return;case"disableCarousel":this.disableCarousel();return;case"enableCarousel":this.enableCarousel();return;case"config":this.config(e[1],e[2]),this._carouselConfiguration.validate();break;case"reinitialize":this._reinitializeCarousel();return}}},t.fn.NCarousel=function(){var e=arguments[0],n=arguments;return this.each(function(r,i){var s=t(i),o=s.data("NCarousel");o!=undefined&&o instanceof l?o.command(n):new l(t(this),e)})},l});