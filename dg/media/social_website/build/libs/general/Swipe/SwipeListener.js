define(["require","framework/EventManager","jquery"],function(e){var t=e("framework/EventManager"),n=e("jquery"),r=t.extend({_managerReference:null,_mixedTarget:null,_swipeConfigurations:null,_state:null,constructor:function(e,t){this.base(),this._managerReference=e,this._mixedTarget=t,this._swipeConfigurations=[],this._state={swipeActive:!1,swipeStartPosition:null,swipePreviousPosition:null,boundSwipeStartEvent:null,axisLocked:{x:!1,y:!1}},this._bindEvents()},_bindEvents:function(){this.addEventListener("swipeStart",this._onSwipeStart.bind(this)),this.addEventListener("swipeMove",this._onSwipeMove.bind(this)),this.addEventListener("swipeEnd",this._onSwipeEnd.bind(this));var e=this._state.boundSwipeStartEvent=this.triggerEvent.bind(this,"swipeStart"),t=this._mixedTarget;if(t instanceof n)t.on(this._managerReference.deviceEvents.startEvent,e);else{if(typeof t!="string")throw"SwipeListener: invalid target provided: "+t;n("body").on(this._managerReference.deviceEvents.startEvent,t,e)}},addSwipeConfiguration:function(e){var t=this._managerReference.SWIPE_TYPES;switch(e.swipeType){case t.LEFT:case t.RIGHT:this._state.axisLocked.x=!0;break;case t.UP:case t.DOWN:this._state.axisLocked.y=!0;break;case t.AUTODETECT:case t.UP_LEFT:case t.DOWN_LEFT:case t.UP_RIGHT:case t.DOWN_RIGHT:this._state.axisLocked.x=!0,this._state.axisLocked.y=!0}return this._swipeConfigurations.push(e),this},_getInputPosition:function(e){var t={x:e.originalEvent.touches?e.originalEvent.touches[0].pageX:e.pageX,y:e.originalEvent.touches?e.originalEvent.touches[0].pageY:e.pageY};return t},_onSwipeStart:function(e){this._state.swipePreviousPosition=this._state.swipeStartPosition=this._getInputPosition(e),this._state.swipeActive=!0},_onSwipeMove:function(e){if(!this._state.swipeActive)return;var t=this._state.swipeStartPosition,n=this._getInputPosition(e);for(var r=0,i=this._swipeConfigurations.length;r<i;r++){var s=this._swipeConfigurations[r];if(!this._state.swipeActive||s.triggerOnlyOnRelease)continue;this._examineSwipe(s,t,n,e)}this._state.swipePreviousPosition=n},_onSwipeEnd:function(e){if(!this._state.swipeActive)return;var t=this._state.swipeStartPosition,n=this._state.swipePreviousPosition;for(var r=0,i=this._swipeConfigurations.length;r<i;r++){var s=this._swipeConfigurations[r];this._examineSwipe(s,t,n,e)}this._resetSwipe()},_resetSwipe:function(){this._state.swipeActive=!1,this._state.swipeStartPosition=null,this._state.swipePreviousPosition=null},_examineSwipe:function(e,t,n,r){var i=this._calculateDistance(t,n);switch(e.swipeUnits){case this._managerReference.SWIPE_UNITS.PIXELS:if(i<e.swipeDistance)return;break;case this._managerReference.SWIPE_UNITS.PERCENT:}r.preventDefault();var s=this._detectDirection(t,n),o=e.swipeType;if(o!=this._managerReference.SWIPE_TYPES.AUTODETECT&&o!=s)return;var u={distance:i,type:s};e.callback(u),this._resetSwipe()},_calculateDistance:function(e,t){var n=Math.abs(t.x-e.x),r=Math.abs(t.y-e.y);return Math.sqrt(n*n+r*r)},_detectDirection:function(e,t){var n=t.x-e.x,r=t.y-e.y,i=null;if(r!=0)i=Math.abs(n/r);else{if(n==0)return!1;i=Math.abs(r/n)}return i>=this._managerReference.getConfiguration().diagonalThreshold&&i<=1/this._managerReference.getConfiguration().diagonalThreshold?n<0?r<0?this._managerReference.SWIPE_TYPES.UP_LEFT:this._managerReference.SWIPE_TYPES.DOWN_LEFT:r<0?this._managerReference.SWIPE_TYPES.UP_RIGHT:this._managerReference.SWIPE_TYPES.DOWN_RIGHT:Math.abs(n)>Math.abs(r)?n<0?this._managerReference.SWIPE_TYPES.LEFT:this._managerReference.SWIPE_TYPES.RIGHT:r<0?this._managerReference.SWIPE_TYPES.UP:this._managerReference.SWIPE_TYPES.DOWN},matchTarget:function(e,t){return this._mixedTarget==e},matchConfiguration:function(e){return e.swipeType!=null&&e.swipeType!=this._configuration.swipeType||e.swipeAmount!=null&&e.swipeAmount!=this._configuration.swipeAmount||e.swipeUnits!=null&&e.swipeUnits!=this._configuration.swipeUnits||e.triggerOnlyOnRelease!=null&&e.triggerOnlyOnRelease!=this._configuration.triggerOnlyOnRelease||e.callback!=null&&e.callback!=this._configuration.callback?!1:!0},remove:function(){this.destructor()},removeConfiguration:function(){},destructor:function(){var e=this._configuration.mixedTarget,t=this._state.boundSwipeStartEvent;e instanceof n?e.off(this._managerReference.deviceEvents.startEvent,t):typeof e=="string"&&n("body").off(this._managerReference.deviceEvents.startEvent,e,t),e=this._configuration.mixedTarget=null,t=this._state.boundSwipeStartEvent=null,this._configuration=null,this._managerReference=null,this.base()}});return r});