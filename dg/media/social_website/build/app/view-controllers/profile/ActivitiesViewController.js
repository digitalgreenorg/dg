define(["require","framework/controllers/Controller","framework/ViewRenderer","framework/Util","jquery","libs/NCarousel/NCarousel","app/libs/ActivitiesDataFeed","text!app/views/profile/activity.html","text!app/views/collection-video-drawer.html"],function(e){var t=e("framework/controllers/Controller"),n=e("framework/ViewRenderer"),r=e("framework/Util"),i=e("jquery"),s=e("libs/NCarousel/NCarousel"),o=e("app/libs/ActivitiesDataFeed"),u=e("text!app/views/profile/activity.html"),a=e("text!app/views/collection-video-drawer.html"),f=t.extend({constructor:function(e){return this.base(e),this.getActivities(),this},_initReferences:function(e){this.base();var t=this._references;t.dataFeed=new o,t.$activitiesWrapper=e,t.$activitiesContainer=e.find(".js-activities-container"),t.$activitiesShowMoreButton=e.find(".js-activities-show-more-btn")},_initState:function(){this.base();var e=this._state;e.currentPageNumber=0,e.activitiesPerPage=10,e.currentCount=0},_initEvents:function(){this.base();var e=this._boundFunctions,t=this._references;e.onDataProcessed=this._onDataProcessed.bind(this),t.dataFeed.on("dataProcessed",e.onDataProcessed),e.onShowMoreClick=this._onShowMoreClick.bind(this),t.$activitiesShowMoreButton.on("click",e.onShowMoreClick)},setActivitiesPerPage:function(e){return this._state.activitiesPerPage=e,this},getActivitiesPerPage:function(){return this._state.activitiesPerPage},setCurrentPageNumber:function(e){return this._state.currentPageNumber=e,this},getCurrentPageNumber:function(){return this._state.currentPageNumber},_onDataProcessed:function(){$(".js-activities-wrapper-outer").show(),this.getActivities()},getActivities:function(e,t){e==undefined?e=this.getCurrentPageNumber():this.setCurrentPageNumber(e),t==undefined?t=this.getActivitiesPerPage():this.setActivitiesPerPage(t);var n=this._references.dataFeed;n.setInputParam("offset",e,!0),n.setInputParam("limit",t,!0),n.setInputParam("partner",this._references.$activitiesWrapper.attr("data-partnerID"),!0);var r=n.getActivities(),i=n.getTotalCount();if(r==0)return!1;this._prepareData(r),this._renderActivities(r)},_prepareData:function(e){var t=0,n=e.length;for(;t<n;t++){var i=e[t];i._hasImages=i.images&&i.images.length!=0;if(i.collection&&i.collection.videos){var s=i.collection.videos,o={likes:0,views:0,adoptions:0,totalDuration:0},u=[],a=[],f=0,l=s.length;for(;f<l;f++){var c=s[f];o.likes+=c.offlineLikes+c.onlineLikes,o.views+=c.offlineViews+c.onlineViews,o.adoptions+=c.adoptions,o.totalDuration+=c.duration,a.push(c);if(f>0&&(f+1)%3==0||f==l-1)u.push({videos:a}),a=[]}i.collection._carouselSlides=u,o.likes=r.integerCommaFormat(o.likes),o.views=r.integerCommaFormat(o.views),o.adoptions=r.integerCommaFormat(o.adoptions),o.totalDuration=r.secondsToHMSFormat(o.totalDuration),i.collection._collectionStats=o}}},_renderActivities:function(e){var t={activities:e};n.renderAppend(this._references.$activitiesContainer,u,t),this._initCarousels(),stButtons.locateElements()},_initCarousels:function(){var e=this._references.$activitiesContainer.find(".js-carousel-wrapper"),t=0,n=e.length;for(;t<n;t++)new s(e.eq(t),{autoPlay:!1,allowWrapping:!1})},_onShowMoreClick:function(e){e.preventDefault(),e.stopPropagation(),this.getActivities(this.getCurrentPageNumber()+1)},destroy:function(){this.base()}});return f});