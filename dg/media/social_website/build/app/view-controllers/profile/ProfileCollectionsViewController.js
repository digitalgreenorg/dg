define(["require","app/view-controllers/GenericCollectionsViewController","libs/NCarousel/NCarousel","app/libs/GenericCollectionsDataFeed","text!app/views/collection.html","text!app/views/collection-video-drawer.html"],function(e){var t=e("app/view-controllers/GenericCollectionsViewController"),n=e("libs/NCarousel/NCarousel"),r=e("app/libs/GenericCollectionsDataFeed"),i=e("text!app/views/collection.html"),s=e("text!app/views/collection-video-drawer.html"),o=t.extend({constructor:function(e,t){return t==undefined&&(t={}),this.base(e,t),this._setActiveCollection("recent"),this._getCollectionsPage("first"),this},_initReferences:function(e,t){this.base(e,t);var n=this._references,i=new r("api/collectionsSearch");i.addInputParam("userId",!0),this._addCollectionsDataFeed("recent",i);var s=new r("api/collectionsSearch");s.addInputParam("userId",!0),this._addCollectionsDataFeed("completed",s),n.$profileWrapper=e,n.$showMoreButton=e.find(".js-show-more"),n.$hideCollectionsButton=e.find(".js-hide-collections"),n.$collectionsContainer=e.find(".js-collections-container")},_initEvents:function(e){this.base();var t=this._references,n=this._boundFunctions;n.onCollectionTypeClick=this._onCollectionDisplayTypeClick.bind(this),t.$profileWrapper.on("click",".js-collection-type",n.onCollectionTypeClick),n.onShowMoreClick=this._onShowMoreClick.bind(this),t.$showMoreButton.on("click",n.onShowMoreClick),n.onHideCollectionsClick=this._onHideCollectionsClick.bind(this),t.$hideCollectionsButton.on("click",n.onHideCollectionsClick)},_initState:function(e){this.base();var t=this._state;t.currentPage=0;var n=4;this.setCollectionsPerRow(4).setCollectionsPerPage(n).setVideoDrawerClasses("").setVideosPerDrawer(5),this._setAllCollectionsInputParam("offset",t.currentPage)._setAllCollectionsInputParam("limit",n)._setAllCollectionsInputParam("userId",1337)},_onCollectionDisplayTypeClick:function(e){e.preventDefault();var t=jQuery(e.currentTarget),n=t.data("collection-id");this._setActiveCollection(n);var r=this._getAllCurrentCollectionsPages();r.collections.length==0&&this._getCollectionsPage("first")},_onShowMoreClick:function(e){e.preventDefault(),this._getCollectionsPage("next")},_onHideCollectionsClick:function(e){e.preventDefault();var t=this._references,n=t.$collectionsContainer.find(".js-collections-page");if(n.length<=1)return;var r=n.eq(n.length-1),i=this._updateHideCollectionsButtonDisplay.bind(this);r.animate({height:"0px"},function(){r.remove(),i()}),this._setCollectionsPage("previous"),t.$showMoreButton.show()},_onTotalNumberOfCollectionsReached:function(e,t){this.base(),t.currentPage>=t.totalPages-1&&this._references.$showMoreButton.hide()},_setActiveCollection:function(e){var t=this._references.$profileWrapper.find(".js-collection-type"),n=t.filter(".active").data("collection-id");if(e==n)return;var r=t.filter("[data-collection-id="+e+"]");t.removeClass("active"),r.addClass("active"),this._references.$showMoreButton.show(),this._setCurrentCollectionsDataFeed(e)},_renderPartialCollections:function(e){var t=jQuery("<div />");t.append(e);var n=t.find(".js-collections-page");n.css({position:"absolute",visibility:"hidden"}),this._references.$collectionsContainer.append(n);var r=n.height();n.css({height:"0px",position:"",visibility:""}),n.animate({height:r+"px"},function(){n.css({height:""})}),this._updateHideCollectionsButtonDisplay(),this._initVideoCarousels()},_renderAllCollections:function(e){this._references.$collectionsContainer.html(e),this._updateHideCollectionsButtonDisplay(),this._initVideoCarousels()},_updateHideCollectionsButtonDisplay:function(){var e=this._references,t=e.$collectionsContainer.find(".js-collections-page");t.length<=1?e.$hideCollectionsButton.hide():e.$hideCollectionsButton.show()},_initVideoCarousels:function(){var e=this._references.$collectionsContainer.find(".js-carousel-wrapper"),t=0,r=e.length;for(;t<r;t++){var i=e.eq(t);new n(i,{transition:"basic",autoPlay:!1,allowWrapping:!1})}},destroy:function(){this.base()}});return o});