define(["require","framework/controllers/Controller"],function(e){var t=e("framework/controllers/Controller"),n=t.extend({constructor:function(e,t){this.base(e),this._init()},_initReferences:function(e,t){this.base(e);var n=this._references;n.$customSelectElement=e,n.$selectFormElement=e.find("select"),n.$selectedItemLabel=e.find(".js-selected-item-label"),n.$selectOptions=e.find(".js-options")},_initEvents:function(e){this.base();var t=this._references,n=this._boundFunctions;n.preventDefault=function(e){e.preventDefault()},n.onCustomSelectClick=this._onCustomSelectClick.bind(this),t.$customSelectElement.on("click",n.onCustomSelectClick).on("mousedown",n.preventDefault),n.onSelectOptionClick=this._onSelectOptionClick.bind(this),t.$selectOptions.on("click","li",n.onSelectOptionClick).on("mousedown",n.preventDefault),n.onOutsideClick=this._onOutsideClick.bind(this),jQuery("body").on("click",n.onOutsideClick)},_initState:function(e){this.base(),this._state.isOpen=!1},_init:function(){this.base(),this._populateOptions()},_populateOptions:function(){var e=this._references,t=e.$selectFormElement,n=e.$selectOptions,r=t.find("option"),i,s,o=!1,u=0,a=r.length;for(;u<a;u++){s=r.eq(u);var f=s.html(),l=s.attr("value"),c=s.attr("selected")!=""&&s.attr("selected")!=undefined;c&&(o=!0),this.addOption(f,l,c,!1)}o||this._markAsSelected(n.find("li").eq(0)),n.hide(),t.hide()},_onCustomSelectClick:function(e){e.preventDefault(),e.stopPropagation(),this._state.isOpen?this._hideOptions():this._showOptions()},_onSelectOptionClick:function(e){e.preventDefault(),e.stopPropagation();var t=jQuery(e.currentTarget);this._markAsSelected(t),this._hideOptions()},_onOutsideClick:function(){this._hideOptions()},_findByValue:function(e){return this._references.$selectOptions.find("li").filter(function(){return jQuery(this).data("value")==e})},_markAsSelected:function(e){if(e==undefined||!e.length)return!1;var t=this._references,n=e.html(),r=e.data("value");t.$selectedItemLabel.html(n),t.$selectFormElement.find("option").attr("selected",!1),t.$selectFormElement.find('option[value="'+r+'"]').attr("selected","selected"),t.$selectOptions.find("li").not(e).removeClass("selected"),e.addClass("selected"),this.trigger("optionChanged",n,r)},_showOptions:function(){this._references.$selectOptions.show(),this._state.isOpen=!0},_hideOptions:function(){this._references.$selectOptions.hide(),this._state.isOpen=!1},addOption:function(e,t,n,r){r==undefined&&(r=!0);var i=this._references,s=i.$selectOptions;$li=jQuery("<li />").html(e).data("value",t).addClass("item"),s.append($li);if(r){var o=jQuery("<option />").html(e).attr("value",t);i.$selectFormElement.append(o)}n&&this._markAsSelected($li)},setOption:function(e){this._markAsSelected(this._findByValue(e))},destroy:function(){this.base()}});return n});