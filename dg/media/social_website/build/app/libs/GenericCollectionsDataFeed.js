define(["require","app/libs/DigitalGreenDataFeed","app/libs/DataModel","framework/Util"],function(e){var t=e("app/libs/DigitalGreenDataFeed"),n=e("app/libs/DataModel"),r=e("framework/Util"),i=t.extend({_filters:undefined,constructor:function(e){this.base(e);var t=this._dataModel,n=t.addSubModel("collections",!0);this.addInputParam("offset",!0,0,!0),this.addInputParam("limit",!0,10,!0)},_processData:function(e){this.base(e);var t=this._dataModel,n=t.get("collections"),r=e.meta.limit,i=e.meta.offset;t.set("total_count",e.meta.total_count);var s=e.objects,o=i*r;return n.addSubset(s,o),s},getTotalCount:function(){return this._dataModel.get("total_count")},checkHaveAllCollections:function(){var e=this._dataModel.get("collections").get().length,t=this.getTotalCount(),n=e>=t;if(n){var t=this.getTotalCount();this.trigger("totalNumberOfCollectionsReached",{currentPage:this.getInputParam("offset"),totalPages:Math.ceil(t/this.getInputParam("limit")),totalCount:t})}return n},_translatePageDescriptor:function(e){var t=this.getInputParam("offset");if(e!=undefined)switch(e){case"next":t++;break;case"previous":--t<0&&(t=0);break;case"first":t=0;break;default:t=parseInt(e,10)}return t},setCollectionsPage:function(e){var t=this._translatePageDescriptor(e);return this.setInputParam("offset",t),t},getCollectionsPage:function(e,t,n){this.setCollectionsPage(e);var r=this.getInputParam("limit"),i=this._dataModel.get("collections"),s=i.get().length;if(!i.hasSubset(e*r,r)&&!this.checkHaveAllCollections()){var o=this._onCollectionPageReceived.bind(this,n);return this.fetch(t,o),!1}this._onCollectionPageReceived(n)},_onCollectionPageReceived:function(e){this.checkHaveAllCollections();var t=this.getInputParam("offset"),n=this.getInputParam("limit"),r={startPage:t,currentPage:t,countPerPage:n,collections:this._dataModel.get("collections").getSubset(t*n,n)};return e!=undefined&&typeof e=="function"&&e(r),r},getAllCurrentCollectionsPages:function(){this.checkHaveAllCollections();var e={startPage:0,currentPage:this.getInputParam("offset"),countPerPage:this.getInputParam("limit"),collections:this._dataModel.get("collections").get()};return e}});return i});