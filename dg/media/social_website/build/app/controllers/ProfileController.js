define("app/view-controllers/CollectionMostFiltersViewController",["require","framework/controllers/Controller","jquery"],function(e){var t=e("framework/controllers/Controller"),n=e("jquery"),r=t.extend({constructor:function(e){return this.base(e),this},_initReferences:function(e){this.base();var t=this._references;t.$mostFiltersContainer=e.find(".js-most-filters")},_initEvents:function(){this.base();var e=this._boundFunctions,t=this._references;e.onMostFilterClick=this._onMostFilterClick.bind(this),t.$mostFiltersContainer.on("click",".js-most-filter",e.onMostFilterClick)},_onMostFilterClick:function(e){e.preventDefault();var t=n(e.currentTarget),r=t.data("filter-id");this.setActiveFilter(r)},setActiveFilter:function(e){var t=this._references.$mostFiltersContainer.find(".js-most-filter"),n=t.filter(".active").data("filter-id");if(e==n){this.setActiveFilter("-_score");return}var r=t.filter("[data-filter-id="+e+"]");t.removeClass("active"),r.addClass("active"),this.trigger("orderChanged",e)},destroy:function(){this.base()}});return r}),define("app/libs/CollectionsDataFeed",["require","app/libs/DigitalGreenDataFeed","app/libs/DataModel","framework/Util"],function(e){var t=e("app/libs/DigitalGreenDataFeed"),n=e("app/libs/DataModel"),r=e("framework/Util"),i=t.extend({_filters:undefined,constructor:function(e){this.base("api/elasticSearch/"),this._filters={};var t=this._dataModel,n=t.addSubModel("collections",!0);this.addInputParam("searchString",!1,0,!0),this.addInputParam("offset",!0,0,!0),this.addInputParam("limit",!0,0,!0),this.addInputParam("filters",!1,null,!0,n),this.addInputParam("order_by",!1,null,!0,n),e!=-1&&this.addInputParamCacheClear("language__name",n)},fetch:function(e,t){e==undefined&&(e=0),t==undefined&&(t=12),this.setInputParam("offset",e*t,!0),this.setInputParam("limit",t,!0),this.base()},_processData:function(e){this.base(e);var t=this._dataModel,n=t.get("collections"),r=e.meta.limit,i=e.meta.offset/e.meta.limit;t.set("totalCount",e.meta.total_count);var s=e.objects,o=i*r,u=e.facets;return t.set("facets",e.facets),n.addSubset(s,o),s},setFilterStatus:function(e,t,n){var i=this._filters;i[e]==undefined&&(i[e]=[]);var s=i[e].indexOf(t),o=s!=-1;if(n&&o||!n&&!o)return!1;n?i[e].push(t):i[e].splice(s,1);var u=r.Object.clone(i);return this.setInputParam("filters",u),!0},clearFilters:function(){var e=!1,t=this._filters,n;for(n in t){var r=t[n],i=r.length;if(i>0){e=!0;break}}return this._filters={},e},getTotalCount:function(){return this._dataModel.get("totalCount")},getCollections:function(){var e=this.getInputParam("offset"),t=this.getInputParam("limit"),n=this._dataModel.get("collections").getSubset(e*t,t);return n?n:(this.fetch(e,t),!1)}});return i}),define("text!app/views/collection.html",[],function(){return'                            <li>\r\n                                <div class="vid-cat-selected">\r\n                                    <div class="vid-cat">\r\n                                        <a href={{url}}>\r\n                                            <img height=124  width=217  src="{{thumbnailURL}}" />\r\n                                        </a>\r\n                                        <div class="vid-flag">\r\n                                            <ul class="copy-sm copy-white h-list h-list-sm h-list-divided">\r\n                                                <li>{{videos.length}} Video{{#_plural}}s{{/_plural}}</li>\r\n                                                <li>{{_collectionStats.time}}</li>\r\n                                            </ul>\r\n                                        </div>\r\n                                        <div class="vid-cat-inner js-collection-item" data-collection-item-index="{{_index}}">\r\n                                            <div class="vid-cat-hd">\r\n                                                <h3 class="hdg-green hdg-f hdg-bold hdg-trunc">{{title}}</h3>\r\n                                            </div>\r\n                                            <div class="vid-cat-bd">\r\n                                                <p class="copy copy-sm layout-vr-tiny">{{state}} | {{language}}</p>\r\n                                                <p class="copy copy-sm">By: {{partner}}</p>\r\n                                            </div>\r\n                                            <div class="vid-cat-ft">\r\n                                                <ul class="h-list h-list-sm copy-sm copy-lt vid-cat-list">\r\n                                                    <li class="like"><span class="text-hide">Likes</span> {{_collectionStats.likes}}</li>\r\n                                                    <li class="view"><span class="text-hide">Viewed</span> {{_collectionStats.views}}</li>\r\n                                                    <li class="check"><span class="text-hide">Adopted</span> {{_collectionStats.adoptions}}</li>\r\n                                                </ul>\r\n                                            </div>\r\n                                        </div> <!-- End .vid-inner -->\r\n                                    </div> <!-- End .vid-cat -->\r\n                                </div>\r\n                            </li>'}),define("text!app/views/collection-video-drawer.html",[],function(){return'                        <li class="vidDrawer-wrapper {{_videoDrawerClasses}}">\r\n                            <div class="vidDrawer-container js-video-container">\r\n                                {{#_videoDrawers}}\r\n                                <div class="vidDrawer-wrapper-inner js-video-drawer" data-parent-collection-item-index="{{_index}}">\r\n                                    <div class="collection-video-carousel carousel-wrapper js-carousel-wrapper">\r\n                                        <div class="carousel-container js-carousel-container">\r\n                                            <ul class="carousel-list">\r\n                                                <!-- Each slide will be in a li here -->\r\n                                                {{#carouselSlides}}\r\n                                                <li>\r\n                                                    <ul class="vidDrawer clearfix">\r\n                                                        {{#videos}}\r\n                                                        <!-- Implementation Note: -->\r\n                                                        <!-- The "show-playing" and "show-progress" classes toggle display of the respective overlays -->\r\n                                                        <!-- <li class="vidDrawer-video show-playing show-progress js-vidDrawer-video"> -->\r\n                                                        <!-- <li class="vidDrawer-video show-playing js-vidDrawer-video"> -->\r\n                                                        <li class="vidDrawer-video show-progress js-vidDrawer-video">\r\n                                                        <!-- <li class="vidDrawer-video js-vidDrawer-video"> -->\r\n                                                            <div class="vidDrawer-image">\r\n                                                                <a href="{{videoURL}}">\r\n                                                                    <img src="{{thumbnailURL}}" alt="" />\r\n                                                                    <!--<div class="overlay now-playing">\r\n                                                                        Now Playing\r\n                                                                    </div>\r\n                                                                    <div class="overlay progress">\r\n                                                                        <div class="progress-inner">\r\n                                                                            <span class="amount">{{percentWatched}}</span>\r\n                                                                            <span class="percent">%</span>\r\n                                                                            <div class="watched">watched</div>\r\n                                                                        </div>\r\n                                                                    </div>-->\r\n                                                                </a>\r\n                                                            </div>\r\n                                                            <div class="vidDrawer-flag copy-white">\r\n                                                                {{_time}}\r\n                                                            </div>\r\n                                                            <div class="vidDrawer-hd copy-dk">\r\n                                                                {{_videoIndex}}. <a href="{{videoURL}}">{{title}}</a>\r\n                                                            </div>\r\n                                                        </li>\r\n                                                        {{/videos}}\r\n                                                    </ul>\r\n                                                </li>\r\n                                                {{/carouselSlides}}\r\n                                            </ul>\r\n                                        </div>\r\n                                        <div class="arrow-left carousel-previous-slide js-carousel-previous-slide">Previous</div>\r\n                                        <div class="arrow-right carousel-next-slide js-carousel-next-slide">Next</div>\r\n                                    </div>\r\n                                </div>\r\n                                {{/_videoDrawers}}\r\n                                <div class="pointer js-pointer"></div>\r\n                            </div>\r\n                        </li>'}),define("text!app/views/collection-pagination.html",[],function(){return'<ol class="pagination h-list h-list-md h-list-divided copy js-pagination">\r\n    {{#pages}}\r\n    <li><a href="#" class="{{classes}} js-pagination-item" data-page-index="{{pageIndex}}">{{pageNumber}}</a></li>\r\n    {{/pages}}\r\n</ol>'}),define("app/view-controllers/CollectionViewController",["require","framework/controllers/Controller","framework/ViewRenderer","framework/Util","jquery","libs/NCarousel/NCarousel","app/libs/CollectionsDataFeed","text!app/views/collection.html","text!app/views/collection-video-drawer.html","text!app/views/collection-pagination.html"],function(e){var t=e("framework/controllers/Controller"),n=e("framework/ViewRenderer"),r=e("framework/Util"),i=e("jquery"),s=e("libs/NCarousel/NCarousel"),o=e("app/libs/CollectionsDataFeed"),u=e("text!app/views/collection.html"),a=e("text!app/views/collection-video-drawer.html"),f=e("text!app/views/collection-pagination.html"),l=t.extend({constructor:function(e,t){return this.base(e,t),this},_initConfig:function(){this.base();var e=this._config;e.filterChangeRefreshDelay=1e3,e.containerOpenHeight=213},_initReferences:function(e,t){this.base();var n=this._references;n.dataFeed=new o(t),n.$collectionsWrapper=e,n.$loadingIndicator=e.find(".js-loading-indicator"),n.$collectionsContainer=e.find(".js-collections-container"),n.$paginationContainers=e.find(".js-pagination")},_initState:function(){this.base();var e=this._state;e.currentPageNumber=0,e.collectionsPerPage=12,e.collectionsPerRow=4,e.videoDrawerClasses="",e.videosPerDrawer=5},_initEvents:function(){this.base();var e=this._boundFunctions,t=this._references;e.onDataProcessed=this._onDataProcessed.bind(this),t.dataFeed.on("dataProcessed",e.onDataProcessed),e.onInputParamChanged=this._onInputParamChanged.bind(this),t.dataFeed.on("inputParamChanged",e.onInputParamChanged),e.onCollectionItemClick=this._onCollectionItemClick.bind(this),t.$collectionsContainer.on("click",".js-collection-item",e.onCollectionItemClick),e.onPaginationItemClick=this._onPaginationItemClick.bind(this),t.$collectionsWrapper.find(".js-pagination").on("click",".js-pagination-item",e.onPaginationItemClick)},setCollectionsPerPage:function(e){return this._state.collectionsPerPage=e,this},setCollectionsPerRow:function(e){return this._state.collectionsPerRow=e,this},setVideoDrawerClasses:function(e){return this._state.videoDrawerClasses=e,this},setVideosPerDrawer:function(e){return this._state.videosPerDrawer=e,this},getCollections:function(e,t){e==undefined?e=this._state.currentPageNumber:this._state.currentPageNumber=e,t==undefined?t=this._state.collectionsPerPage:this._state.collectionsPerPage=t;var n=this._references.dataFeed;n.setInputParam("offset",e,!0),n.setInputParam("limit",t,!0),$(".js-collections-wrapper").attr("data-searchstring")!=""&&n.setInputParam("searchString",$(".js-collections-wrapper").attr("data-searchstring"));var r=n.getCollections(),i=n.getTotalCount();if(r==0)return!1;this._updateCollectionsDisplay(r,i)},_onDataProcessed:function(){$(".js-collections-wrapper-outer").show(),this.getCollections()},_updateCollectionsDisplay:function(e,t){this._renderCollections(e),this._renderPagination(t),this._initVideoCarousels(),this._references.$loadingIndicator.hide();var n={totalCount:t};this.trigger("collectionsUpdated",n)},_initVideoCarousels:function(){var e=this._references.$collectionsContainer.find(".js-carousel-wrapper"),t=0,n=e.length;for(;t<n;t++)new s(e.eq(t),{autoPlay:!1,allowWrapping:!1})},_renderCollections:function(e,t){var i=this._state,s=i.collectionsPerRow,o=i.videoDrawerClasses,f="",l=[],c=0,h,p=e.length;for(;c<p;c++){var d=r.Object.clone(e[c],!0);d._index=c,d._collectionStats=this._getCollectionStats(d),d._plural=d.videos.length!=1,f+=n.render(u,d);for(h=0;h<d.videos.length;h++)d.videos[h]._time=r.secondsToHMSFormat(d.videos[h].duration);var v=this._prepareVideoDrawerData(d.videos);v._index=c,l.push(v);if((c+1)%s==0||c==p-1)f+=n.render(a,{_videoDrawerClasses:o,_videoDrawers:l}),l.splice(0)}this._references.$collectionsContainer.html(f)},_getCollectionStats:function(e){var t=0,n=e.videos;if(!n)throw new Error("CollectionViewController._getCollectionStats(): trying to get collection stats on an object with no videos array");var i=0,s=n.length;for(;i<s;i++){var o=n[i];t+=o.duration}var u="";e.adoptions<1e4?u=r.integerCommaFormat(e.adoptions):u=r.integerAbbreviatedFormat(e.adoptions);var a="";e.views<1e4?a=r.integerCommaFormat(e.views):a=r.integerAbbreviatedFormat(e.views);var f="";return e.likes<1e4?f=r.integerCommaFormat(e.likes):f=r.integerAbbreviatedFormat(e.likes),{time:r.secondsToHMSFormat(t),adoptions:u,views:a,likes:f}},_prepareVideoDrawerData:function(e){var t=this._state.videosPerDrawer,n=[],r=0,i=e.length,s,o;for(;r<i;r+=t){o=[];for(s=0;s<t&&s+r<i;s++){var u=e[r+s];u._videoIndex=s+r+1,o.push(u)}n.push({videos:o})}return{carouselSlides:n}},_renderPagination:function(e){var t=this._state.collectionsPerPage,r=Math.ceil(e/t),i=[],s=0;for(;s<r;s++){var o={pageIndex:s,pageNumber:s+1};s==this._state.currentPageNumber&&(o.classes="selected"),i.push(o)}var u=n.render(f,{pages:i});this._references.$paginationContainers.html(u)},_onPaginationItemClick:function(e){e.preventDefault();var t=i(e.currentTarget),n=t.data("pageIndex");if(n==this._state.currentPageNumber)return;var r=this._references.$paginationContainers.find(".js-pagination-item");r.removeClass("selected");var s=r.filter("[data-page-index="+n+"]");s.addClass("selected"),this._references.$loadingIndicator.show(),this.getCollections(n)},_onCollectionItemClick:function(e){var t=i(e.currentTarget),n=t.data("collectionItemIndex"),r=this._references.$collectionsContainer.find(".js-video-container"),s=r.find(".js-video-drawer"),o,u=0,a=s.length;for(;u<a;u++){var f=s.eq(u);if(f.data("parentCollectionItemIndex")==n){o=f;break}}var l=o.closest(".js-video-container"),c=l.find(".js-video-drawer").not(o),h=l.hasClass("open");h||(this._openVideoDrawerContainers(l),this._closeVideoDrawerContainers(r.not(l)));var p;this._references.$collectionsContainer.find(".js-video-container").each(function(){$(this).hasClass("open")&&(p=$(this).find(".js-video-drawer").filter(function(){return $(this).css("visibility")=="visible"}))});if(n==p.data("parentCollectionItemIndex"))this._hideDrawers(o),this._closeVideoDrawerContainers(l);else{this._showDrawers(o),this._hideDrawers(c);var d=l.find(".js-pointer"),v=t.offset().left,m=t.width(),g=o.offset().left,y=d.width(),b=20,w=v-g+m/2-y/2+b;h?d.animate({left:w+"px"}):d.css("left",w)}},_openVideoDrawerContainers:function(e){e.stop(!0).animate({height:this._config.containerOpenHeight+"px"}).addClass("open")},_closeVideoDrawerContainers:function(e){e.stop(!0).animate({height:"0px"}).removeClass("open")},_showDrawers:function(e){e.css({position:"relative",visibility:"visible"})},_hideDrawers:function(e){e.css({position:"",visibility:""})},setInputParam:function(e,t,n){this._references.dataFeed.setInputParam(e,t,n)},setFilterStatus:function(e,t,n){this._references.dataFeed.setFilterStatus(e,t,n)},clearFilters:function(){if(!this._references.dataFeed.clearFilters())return;this._onSearchCriteriaChanged()},_onInputParamChanged:function(){this._onSearchCriteriaChanged()},_onSearchCriteriaChanged:function(){this._references.$loadingIndicator.show(),this.getCollections(0)},destroy:function(){this.base()}});return l}),define("app/libs/ActivitiesDataFeed",["require","app/libs/DigitalGreenDataFeed","app/libs/DataModel"],function(e){var t=e("app/libs/DigitalGreenDataFeed"),n=e("app/libs/DataModel"),r=t.extend({_filters:undefined,constructor:function(){this.base("api/activity/");var e=this._dataModel.addSubModel("activities",!0);this.addInputParam("partner",!1,undefined,!0,e),this.addInputParam("farmerID",!1,undefined,!0,e),this.addInputParam("userUID",!1,undefined,!0,e),this.addInputParamCacheClear("language__name",e),this.addInputParam("offset",!1),this.addInputParam("limit",!1)},fetch:function(e,t){e==undefined&&(e=0),t==undefined&&(t=10),this.setInputParam("offset",e*t,!0),this.setInputParam("limit",t,!0),this.base()},_processData:function(e){this.base(e);var t=this._dataModel,n=t.get("activities"),r=e.meta.limit,i=e.meta.offset;t.set("totalCount",e.meta.total_count);var s=e.objects,o=i;return n.addSubset(s,o),s},clearCollectionCache:function(){this._dataModel.get("activities").clear()},getTotalCount:function(){return this._dataModel.get("totalCount")},getActivities:function(){var e=this.getInputParam("offset"),t=this.getInputParam("limit"),n=this._dataModel.get("activities").getSubset(e*t,t);return n?n:(this.fetch(e,t),!1)}});return r}),define("text!app/views/profile/activity.html",[],function(){return'                    {{#activities}}\r\n                    <li>\r\n                        <div class="grid activity">\r\n                            <div class="grid-col date copy">\r\n                                {{date}}\r\n                            </div>\r\n                            <i class="indicator"></i>\r\n                            <div class="grid-col event">\r\n                                <div class="event-box">\r\n                                    <div class="media">\r\n                                        <div class="img">\r\n                                            <img src="{{avatarURL}}" height="62px" width="62px" alt="" />\r\n                                        </div>\r\n                                        <div class="bd">\r\n                                            <div class="bd-text-event">\r\n                                                <a href="{{titleURL}}"><h3 class="hdg-green copy layout-vr-tiny hdg-bold">{{title}}</h3></a>\r\n                                                <p class="copy copy">\r\n                                                    {{textContent}}\r\n                                                </p>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {{#_hasImages}}\r\n                                    <ul class="h-list layout-vr-md">\r\n                                        {{#images}}\r\n                                        <li>\r\n                                            <a href="{{imageLinkURL}}"><img src="{{imageURL}}" alt="{{altString}}" /></a>\r\n                                        </li>\r\n                                        {{/images}}\r\n                                    </ul>\r\n                                    {{/_hasImages}}\r\n\r\n                                    <!-- Begin Video Collection -->\r\n                                    {{#collection}}\r\n                                    <div class="grid layout-vr-md">\r\n                                        <div class="grid-col">\r\n                                            <div class="vid-cat-selected">\r\n                                                <div class="vid-cat">\r\n                                                    <a href="{{titleURL}}"><img src="{{collection.thumbnailURL}} " width="217px" /></a>\r\n                                                    <div class="vid-flag">\r\n                                                        <ul class="copy-sm copy-white h-list h-list-sm h-list-divided">\r\n                                                            <li>{{collection.videos.length}} Videos</li>\r\n                                                            <li>{{collection._collectionStats.totalDuration}}</li>\r\n                                                        </ul>\r\n                                                    </div>\r\n                                                    <div class="vid-cat-inner">\r\n                                                        <div class="vid-cat-hd">\r\n                                                            <h3 class="hdg-green hdg-f copy hdg-bold">{{collection.title}}</h3>\r\n                                                        </div>\r\n                                                        <div class="vid-cat-bd">\r\n                                                            <p class="copy copy-sm layout-vr-tiny">{{collection.state}} | {{collection.language}}</p>\r\n                                                            <p class="copy copy-sm">By: {{collection.partner.name}}</p>\r\n                                                        </div>\r\n                                                        <!-- NOTE: These aren\'t present in the comps, but included in case they\'re later desired -->\r\n                                                        <!-- <div class="vid-cat-ft">\r\n                                                            <ul class="h-list h-list-sm copy-sm copy-lt vid-cat-list">\r\n                                                                <li class="like">{{collection._collectionStats.likes}}</li>\r\n                                                                <li class="view">{{collection._collectionStats.views}}</li>\r\n                                                                <li class="check">{{collection._collectionStats.adoptions}}</li>\r\n                                                            </ul>\r\n                                                        </div> -->\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div class="grid-lt">\r\n                                            <div class="news-videoDrawer news-videoDrawer-profile">\r\n                                                <div class="activity-video-carousel carousel-wrapper js-carousel-wrapper">\r\n                                                    <div class="carousel-container js-carousel-container">\r\n                                                        <ul class="carousel-list">\r\n                                                            {{#collection._carouselSlides}}\r\n                                                            <li>\r\n                                                                <ul class="h-list">\r\n                                                                    {{#videos}}\r\n                                                                    <li>\r\n                                                                        <a href="{{titleURL}}"><img src="{{thumbnailURL16by9}}" alt="{{title}}" width="115px" height="64px" /></a>\r\n                                                                    </li>\r\n                                                                    {{/videos}}\r\n                                                                </ul>\r\n                                                            </li>\r\n                                                            {{/collection._carouselSlides}}\r\n                                                        </ul>\r\n                                                    </div>\r\n                                                    <div class="arrow arrow-left carousel-previous-slide js-carousel-previous-slide">Previous</div>\r\n                                                    <div class="arrow arrow-right carousel-next-slide js-carousel-next-slide">Next</div>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                    <!-- End Video Collection -->\r\n                                    {{/collection}}\r\n\r\n                                    <!-- <ul class="h-list h-list-divided copy copy list-icons-green layout-vr-md">\r\n                                        <li class="like"><a href="#"><span class="copy-dk">{{_likes}}</span> Likes</a></li>\r\n                                        <li class="comment"><a href="#">Comment</a></li>\r\n                                        <li>\r\n                                            <a class="btn share-btn alt"><div class="icon"></div>\r\n                                                <span class="label">Share</span>\r\n\r\n                                                <div class="sharethis-wrapper">\r\n                                                    <div class=\'st_facebook_hcount\' displayText=\'Facebook\'></div>\r\n                                                    <div class=\'st_twitter_hcount\' displayText=\'Tweet\'></div>\r\n                                                    <div class=\'st_linkedin_hcount\' displayText=\'LinkedIn\'></div>\r\n                                                    <div class=\'st_email_hcount\' displayText=\'Email\'></div>\r\n                                                </div>\r\n                                            </a>\r\n                                        </li>\r\n\r\n                                    </ul> -->\r\n                                    <!-- <div class="commentBox commentBox-arrow">\r\n\r\n                                        {{#_hasComments}}\r\n                                        <div class="comments-left">\r\n                                            <h4 class="copy layout-vr-md">{{numberOfComments}} Comments</h4>\r\n                                            <ol class="comment-list">\r\n                                                {{#comments}}\r\n                                                <li>\r\n                                                    <div class="media">\r\n                                                        <div class="img">\r\n                                                            <img src="{{user.avatarURLSmall}}" alt="User Avatar">\r\n                                                        </div>\r\n                                                        <div class="bd">\r\n                                                            <h5 class="hdg-green hdg-bold copy layout-vr-sm">{{user.name}}</h5>\r\n                                                            <p class="copy layout-vr-sm">{{text}}</p>\r\n                                                            <p class="copy copy-lt">{{date}}</p>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </li>\r\n                                                {{/comments}}\r\n                                            </ol>\r\n                                        </div>\r\n                                        {{/_hasComments}}\r\n\r\n                                        <div class="commentBox-form js-comment-container">\r\n                                            <form>\r\n                                                <label for="comment" class="text-hide">Comments</label>\r\n                                                <input type="text" class="comment-text js-comment-text" placeholder="Write a comment or ask a question..." />\r\n                                                <input type="submit" class="btn" value="Submit" />\r\n                                            </form>\r\n                                        </div>\r\n                                    </div> -->\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </li>\r\n                    {{/activities}}'}),define("app/view-controllers/profile/ActivitiesViewController",["require","framework/controllers/Controller","framework/ViewRenderer","framework/Util","jquery","libs/NCarousel/NCarousel","app/libs/ActivitiesDataFeed","text!app/views/profile/activity.html","text!app/views/collection-video-drawer.html"],function(e){var t=e("framework/controllers/Controller"),n=e("framework/ViewRenderer"),r=e("framework/Util"),i=e("jquery"),s=e("libs/NCarousel/NCarousel"),o=e("app/libs/ActivitiesDataFeed"),u=e("text!app/views/profile/activity.html"),a=e("text!app/views/collection-video-drawer.html"),f=t.extend({constructor:function(e){return this.base(e),this.getActivities(),this},_initReferences:function(e){this.base();var t=this._references;t.dataFeed=new o,t.$activitiesWrapper=e,t.$activitiesContainer=e.find(".js-activities-container"),t.$activitiesShowMoreButton=e.find(".js-activities-show-more-btn")},_initState:function(){this.base();var e=this._state;e.currentPageNumber=0,e.activitiesPerPage=10,e.currentCount=0},_initEvents:function(){this.base();var e=this._boundFunctions,t=this._references;e.onDataProcessed=this._onDataProcessed.bind(this),t.dataFeed.on("dataProcessed",e.onDataProcessed),e.onShowMoreClick=this._onShowMoreClick.bind(this),t.$activitiesShowMoreButton.on("click",e.onShowMoreClick)},setActivitiesPerPage:function(e){return this._state.activitiesPerPage=e,this},getActivitiesPerPage:function(){return this._state.activitiesPerPage},setCurrentPageNumber:function(e){return this._state.currentPageNumber=e,this},getCurrentPageNumber:function(){return this._state.currentPageNumber},_onDataProcessed:function(){$(".js-activities-wrapper-outer").show(),this.getActivities()},getActivities:function(e,t){e==undefined?e=this.getCurrentPageNumber():this.setCurrentPageNumber(e),t==undefined?t=this.getActivitiesPerPage():this.setActivitiesPerPage(t);var n=this._references.dataFeed;n.setInputParam("offset",e,!0),n.setInputParam("limit",t,!0),n.setInputParam("partner",this._references.$activitiesWrapper.attr("data-partnerID"),!0);var r=n.getActivities(),i=n.getTotalCount();if(r==0)return!1;this._prepareData(r),this._renderActivities(r)},_prepareData:function(e){var t=0,n=e.length;for(;t<n;t++){var i=e[t];i._hasImages=i.images&&i.images.length!=0;if(i.collection&&i.collection.videos){var s=i.collection.videos,o={likes:0,views:0,adoptions:0,totalDuration:0},u=[],a=[],f=0,l=s.length;for(;f<l;f++){var c=s[f];o.likes+=c.offlineLikes+c.onlineLikes,o.views+=c.offlineViews+c.onlineViews,o.adoptions+=c.adoptions,o.totalDuration+=c.duration,a.push(c);if(f>0&&(f+1)%3==0||f==l-1)u.push({videos:a}),a=[]}i.collection._carouselSlides=u,o.likes=r.integerCommaFormat(o.likes),o.views=r.integerCommaFormat(o.views),o.adoptions=r.integerCommaFormat(o.adoptions),o.totalDuration=r.secondsToHMSFormat(o.totalDuration),i.collection._collectionStats=o}}},_renderActivities:function(e){var t={activities:e};n.renderAppend(this._references.$activitiesContainer,u,t),this._initCarousels(),stButtons.locateElements()},_initCarousels:function(){var e=this._references.$activitiesContainer.find(".js-carousel-wrapper"),t=0,n=e.length;for(;t<n;t++)new s(e.eq(t),{autoPlay:!1,allowWrapping:!1})},_onShowMoreClick:function(e){e.preventDefault(),e.stopPropagation(),this.getActivities(this.getCurrentPageNumber()+1)},destroy:function(){this.base()}});return f}),define("app/libs/PartnerFarmersDataFeed",["require","app/libs/DigitalGreenDataFeed","app/libs/DataModel"],function(e){var t=e("app/libs/DigitalGreenDataFeed"),n=e("app/libs/DataModel"),r=t.extend({_filters:undefined,constructor:function(){this.base("api/partnerFarmers/");var e=this._dataModel.addSubModel("partnerFarmers",!0);this.addInputParam("uid",!1,undefined,!0,e),this.addInputParamCacheClear("language__name",e),this.addInputParam("offset",!1),this.addInputParam("limit",!1),this.getPartnerFarmers()},fetch:function(e,t){e==undefined&&(e=0),t==undefined&&(t=12),this.setInputParam("uid",$(".js-partner-farmers-pages-container").attr("data-partnerID")),this.setInputParam("offset",e,!0),this.setInputParam("limit",t,!0),this.base()},_processData:function(e){this.base(e);var t=this._dataModel,n=t.get("partnerFarmers"),r=e.meta.limit,i=e.meta.offset;t.set("totalCount",e.objects[0].farmer.length);var s=e.objects[0].farmer,o=i*r;return n.addSubset(s,o),s},clearCollectionCache:function(){this._dataModel.get("partnerFarmers").clear()},getTotalCount:function(){return this._dataModel.get("totalCount")},getPartnerFarmers:function(){var e=this.getInputParam("offset"),t=this.getInputParam("limit"),n=this._dataModel.get("partnerFarmers").getSubset(e*t,t);return n?n:(this.fetch(e,t),!1)}});return r}),define("text!app/views/partnerFarmer.html",[],function(){return'<li class="js-partner-farmers-page">\r\n    <ul class="media h-list h-list-lg imgBorder js-partner-farmers-page-list">\r\n        {{#farmers}}\r\n        <li class="js-partner-farmers-item img-size-sq-small">\r\n            <a href="http://www.digitalgreen.org/farmerbook/person/{{coco_id}}" target="_blank">\r\n                <img src="{{thumbnailURL}}" alt ="Farmer {{name}} thumbnail" title="{{name}}">\r\n            </a>\r\n        </li>\r\n        {{/farmers}}\r\n    </ul>\r\n</li>'}),define("app/view-controllers/PartnerFarmersViewController",["require","framework/controllers/Controller","framework/ViewRenderer","framework/Util","jquery","app/libs/PartnerFarmersDataFeed","text!app/views/partnerFarmer.html"],function(e){var t=e("framework/controllers/Controller"),n=e("framework/ViewRenderer"),r=e("framework/Util"),i=e("jquery"),s=e("app/libs/PartnerFarmersDataFeed"),o=e("text!app/views/partnerFarmer.html"),u=t.extend({constructor:function(e){return this.base(e),this},_initConfig:function(){this.base()},_initReferences:function(e){this.base();var t=this._references;t.dataFeed=new s,t.$farmerCarouselContainer=e,t.$farmerPagesContainer=e.find(".js-partner-farmers-pages-container"),t.$prevFarmerPageInput=e.find(".js-prev-partner-farmers-page"),t.$nextFarmerPageInput=e.find(".js-next-partner-farmers-page")},_initState:function(){this.base();var e=this._state;e.currentPageNumber=0,e.farmersPerPage=12,e.currentCount=0,e.totalCount=0},_initEvents:function(){this.base();var e=this._boundFunctions,t=this._references;e.onDataProcessed=this._onDataProcessed.bind(this),t.dataFeed.on("dataProcessed",e.onDataProcessed),e.onCarouselPagingPreviousClick=this._onCarouselPagingClick.bind(this,-1),t.$prevFarmerPageInput.click(e.onCarouselPagingPreviousClick),e.onCarouselPagingNextClick=this._onCarouselPagingClick.bind(this,1),t.$nextFarmerPageInput.click(e.onCarouselPagingNextClick)},setCurrentPageNumber:function(e){return this._state.currentPageNumber=e,this},getCurrentPageNumber:function(){return this._state.currentPageNumber},setFarmersPerPage:function(e){return this._state.farmersPerPage=e,this},getFarmersPerPage:function(){return this._state.farmersPerPage},addToCurrentCount:function(e){return this._state.currentCount+=e,this},getTotalPages:function(){return Math.ceil(this.getTotalCount()/this.getFarmersPerPage())-1},setTotalCount:function(e){return this._state.totalCount=e,this},getTotalCount:function(){return this._state.totalCount},getPartnerFarmers:function(e,t){e==undefined?e=this.getCurrentPageNumber():this.setCurrentPageNumber(e),t==undefined?t=this.getFarmersPerPage():this.setFarmersPerPage(t);var n=this._references.dataFeed;n.setInputParam("offset",e,!0),n.setInputParam("limit",t,!0);var r=n.getPartnerFarmers(),i=n.getTotalCount();if(r==0)return!1;this._updateFarmersDisplay(r,i)},_onDataProcessed:function(){$(".js-partner-farmers-carousel-container-outer").show(),this.getPartnerFarmers()},_updateFarmersDisplay:function(e,t){this._renderPartnerFarmers(e),this.setTotalCount(t),this.addToCurrentCount(e.length),this.updatePartnerFarmersPaginationDisplay()},_renderPartnerFarmers:function(e){var t=[],i=0,s=e.length;for(;i<s;i++){var u=r.Object.clone(e[i],!0);t.push(u)}this._references.$farmerPagesContainer.empty();var a={farmers:e};n.renderAppend(this._references.$farmerPagesContainer,o,a)},updatePartnerFarmersPaginationDisplay:function(){this.getCurrentPageNumber()<=0?this._references.$prevFarmerPageInput.hide():this._references.$prevFarmerPageInput.show(),this.getCurrentPageNumber()>=this.getTotalPages()?this._references.$nextFarmerPageInput.hide():this._references.$nextFarmerPageInput.show()},_onCarouselPagingClick:function(e,t){t.preventDefault(),t.stopPropagation(),this.getPartnerFarmers(this.getCurrentPageNumber()+e)},setInputParam:function(e,t,n){this._references.dataFeed.setInputParam(e,t,n)},destroy:function(){this.base()}});return u}),define("controllers/ProfileController",["require","app/controllers/DigitalGreenPageController","jquery","app/view-controllers/CollectionMostFiltersViewController","app/view-controllers/CollectionViewController","app/view-controllers/profile/ActivitiesViewController","app/view-controllers/PartnerFarmersViewController"],function(e){var t=e("app/controllers/DigitalGreenPageController"),n=e("jquery"),r=e("app/view-controllers/CollectionMostFiltersViewController"),i=e("app/view-controllers/CollectionViewController"),s=e("app/view-controllers/profile/ActivitiesViewController"),o=e("app/view-controllers/PartnerFarmersViewController"),u=t.extend({constructor:function(e,t){this.base(e,t);var n=this._references,r=4;n.collectionViewController.setCollectionsPerPage(r).setCollectionsPerRow(4).setVideosPerDrawer(5),n.collectionMostFiltersViewController.setActiveFilter("-likes");var i=$(".js-partner-farmers-pages-container").attr("data-partnerID");return this._references.collectionViewController._references.dataFeed.addInputParam("uid",!0,0,!0),this._references.collectionViewController._references.dataFeed.setInputParam("uid",i,!0),this._getCollections(0,r),this},_initReferences:function(e,t){this.base(e);var u=this._references,a=n(".js-collections-wrapper");u.collectionViewController=new i(a),u.collectionMostFiltersViewController=new r(a);var f=n(".js-activities-wrapper");u.activitiesViewController=new s(f);var l=n(".js-partner-farmers-carousel-container");u.partnerFarmersViewController=new o(l),u.$showMoreButton=n(".js-show-more"),u.$hideCollectionsButton=n(".js-hide-collections")},_initEvents:function(){this.base();var e=this._references,t=this._boundFunctions;t.onOrderChanged=this._onOrderChanged.bind(this),e.collectionMostFiltersViewController.on("orderChanged",t.onOrderChanged)},_onOrderChanged:function(e){this._references.collectionViewController.setInputParam("order_by",e)},_getCollections:function(e,t){return this._references.collectionViewController.getCollections(e,t)},destroy:function(){this.base()}});return u});