define("app/libs/SearchFiltersDataFeed",["require","app/libs/DigitalGreenDataFeed","app/libs/DataModel"],function(e){var t=e("app/libs/DigitalGreenDataFeed"),n=e("app/libs/DataModel"),r=t.extend({constructor:function(){this.base("api/searchFilters")},_initConfig:function(){this.base(),this._config.fetchDelay=0},_processData:function(e){return this.base(e),this._dataModel.set("searchFilters",e),e},getSearchFilters:function(){return this._dataModel.get("searchFilters")}});return r}),define("text!app/views/collection-filter-list.html",[],function(){return'                            {{#categories}}\r\n                            {{#options.length}}\r\n                            <li class="js-filter-category {{#categoryOpen}}open{{/categoryOpen}}" data-category-id="{{_categoryId}}">\r\n                                <div class="filter-category-label js-filter-category-label">{{title}}</div>\r\n                                <div class="filter-subcategory-wrapper js-subcategory-wrapper">\r\n                                    <ul class="sorting-categories v-list-divided js-subcategory-container">\r\n                                        {{#options}}\r\n                                        <li class="js-filter-option {{#filterActive}}enabled{{/filterActive}}" data-option-id="{{title}}">\r\n                                            <!-- <input id="adultManagement" type="checkbox" /> -->\r\n                                            <div class="custom-checkbox"></div>\r\n                                            <label for="adultManagement">{{title}} ({{count}})</label>\r\n                                        </li>\r\n                                        {{/options}}\r\n                                    </ul>\r\n                                </div>\r\n                            </li>\r\n                            {{/options.length}}\r\n                            {{/categories}}'}),define("text!app/views/collection-filter-breadcrumbs.html",[],function(){return'                            <li class="hdg-bold copy-dk">{{totalCount}} Collections Found</li>\r\n                            {{#activeFilters}}\r\n                            <li><a href="#" class="remove remove-dk js-remove-filter" data-category-id="{{categoryId}}" data-option-id="{{title}}">{{title}}<span></span></a></li>\r\n                            {{/activeFilters}}\r\n'}),define("app/view-controllers/CollectionFiltersViewController",["require","framework/controllers/Controller","framework/globalEventManager","framework/ViewRenderer","framework/Util","jquery","app/libs/SearchFiltersDataFeed","text!app/views/collection-filter-list.html","text!app/views/collection-filter-breadcrumbs.html"],function(e){var t=e("framework/controllers/Controller"),n=e("framework/globalEventManager"),r=e("framework/ViewRenderer"),i=e("framework/Util"),s=e("jquery"),o=e("app/libs/SearchFiltersDataFeed"),u=e("text!app/views/collection-filter-list.html"),a=e("text!app/views/collection-filter-breadcrumbs.html"),f=t.extend({constructor:function(e){return this.base(e),this._fetchFilters(),this},_initReferences:function(e){this.base();var t=this._references;t.dataFeed=new o,t.filters_cleared=0,t.$filtersWrapper=e,t.$filtersContainer=e.find(".js-filters-container"),t.$filterBreadcrumbsContainer=s(".js-filter-breadcrumbs")},_initState:function(){this.base(),this._state.filterData={}},_initEvents:function(){this.base();var e=this._boundFunctions,t=this._references;e.onFilterCategoryLabelClick=this._onFilterCategoryLabelClick.bind(this),t.$filtersContainer.on("click",".js-filter-category-label",e.onFilterCategoryLabelClick),e.onFilterOptionClick=this._onFilterOptionClick.bind(this),t.$filtersContainer.on("click",".js-filter-option",e.onFilterOptionClick),e.onBreadcrumbsRemoveFilterClick=this._onBreadcrumbsRemoveFilterClick.bind(this),t.$filterBreadcrumbsContainer.on("click",".js-remove-filter",e.onBreadcrumbsRemoveFilterClick),e.onClearAllFiltersClick=this._onClearAllFiltersClick.bind(this),t.$filtersWrapper.on("click",".js-clear-all-filters",e.onClearAllFiltersClick)},_onFilterCategoryLabelClick:function(e){e.preventDefault();var t=this._state.filterData.categories,n=s(e.currentTarget).closest(".js-filter-category"),r=n.data("categoryId");if(t[r].categoryOpen){n.find(".js-subcategory-wrapper").stop(!0).animate({height:"0px"},1e3),n.removeClass("open");return}var i;for(i in t)t[i].categoryOpen=!1;var o=this._references.$filtersContainer.find(".js-filter-category").not(n);o.find(".js-subcategory-wrapper").stop(!0).animate({height:"0px"},1e3),o.removeClass("open"),t[r].categoryOpen=!0;var u=n.find(".js-subcategory-container");n.find(".js-subcategory-wrapper").stop(!0).animate({height:u.outerHeight()+"px"},1e3),n.addClass("open")},_onFilterOptionClick:function(e){e.preventDefault();var t=s(e.currentTarget),n=t.closest(".js-filter-category"),r=n.data("category-id"),i=t.data("option-id"),o=this._state.filterData,u=this._getFilterStatus(r,i),a=!u;this._setFilterStatus(r,i,a),this._renderFilters()},_onBreadcrumbsRemoveFilterClick:function(e){e.preventDefault(),this._references.filters_cleared=1;var t=s(e.currentTarget),n=t.data("categoryId"),r=t.data("optionId");this._setFilterStatus(n,r,!1),this._renderFilters()},_onClearAllFiltersClick:function(e){e.preventDefault(),this._clearFilters(),this._references.$filtersContainer.find(".js-filter-option.enabled").removeClass("enabled"),this._updateBreadcrumbs(),this.trigger("filtersCleared")},_indicateCurrentLanguageSelection:function(){var e=i.Cookie.get("language__name");if(!e)return;var t=this._state.filterData.categories.language;if(!t)return;try{var n=this._state.filterData.categories.language.options}catch(r){return}var s=0,o=n.length;for(;s<o;s++)if(n[s].value==e){this._setFilterStatus("language__name",s,!0);return}},_clearFilters:function(){var e=this._state.filterData;if(e.categories==undefined)return;var t=e.categories,n,r,i;for(n in t){var s=t[n],o=s.options;if(o==undefined)continue;r=0,i=o.length;for(;r<i;r++){var u=o[r];if(!u.filterActive)continue;u.filterActive=!1}}},updateTotalCount:function(e){this._state.totalCount=e,this._updateBreadcrumbs()},_updateBreadcrumbs:function(){var e=this._getActiveFilters(),t={totalCount:this._state.totalCount,activeFilters:e};r.renderHTML(this._references.$filterBreadcrumbsContainer,a,t)},_setFilterStatus:function(e,t,n){e=="language__name"&&(e="language");var r,i=this._state.filterData.categories[e],s;for(r=0;r<i.options.length;r++)i.options[r].title==t&&(s=this._state.filterData.categories[e].options[r]);if(s==undefined)return;s.filterActive=n,this._updateBreadcrumbs(),this.trigger("filterChanged",e,s.value,n)},_getFilterStatus:function(e,t){var n;for(n=0;n<this._state.filterData.categories[e].options.length;n++)if(this._state.filterData.categories[e].options[n].title==t)return this._state.filterData.categories[e].options[n].filterActive},_findFilterElementById:function(e,t){var n=this._references.$filtersContainer,r=n.find("[data-category-id="+e+"]"),i=r.find("[data-option-id="+t+"]");return i},_fetchFilters:function(){this._references.dataFeed.fetch(null,this._onDataProcessed.bind(this))},_onDataProcessed:function(){this._state.filterData=this._references.dataFeed.getSearchFilters(),this._renderFilters()},_getFilterDataForRender:function(){var e=this._state.filterData,t=[],n=this._getActiveFilters(),r=e.categories,s,o;for(s in r){var u=i.Object.clone(r[s],!0);u._categoryId=s;var a=u.options;for(o=0;o<a.length;o++){var f=a[o];if(f.dependencies){var l=this._checkFilterDependcies(f.dependencies);if(!l){a.splice(o,1),o--;continue}}u.options[o]._optionId=o}t.push(u)}var c={categories:t};return c},_checkFilterDependcies:function(e){return this._checkFilterAllOfDependencies(e.allOf)&&this._checkFilterOneOfDependencies(e.oneOf)},_checkFilterAllOfDependencies:function(e){if(e==undefined)return!0;var t=this._state.filterData.categories,n;for(n in e){if(!(n in t))return!1;var r=e[n],i=0,s=r.length;for(;i<s;i++){var o=r[i],u=t[n].options,a=!1,f=0,l=u.length;for(;f<l;f++){var c=u[f];if(o!=c.value)continue;if(!c.filterActive)return!1;a=!0;break}if(!a)return!1}}return!0},_checkFilterOneOfDependencies:function(e){if(e==undefined)return!0;var t=this._state.filterData.categories,n;for(n in e){if(!(n in t))return!1;var r=!1,i=e[n],s=0,o=i.length;for(;s<o;s++){var u=i[s],a=t[n].options,f=0,l=a.length;for(;f<l;f++){var c=a[f];if(u==c.value&&c.filterActive){r=!0;break}}if(r)break}if(!r)return!1}return!0},_renderFilters:function(){var e=this._getFilterDataForRender();r.renderHTML(this._references.$filtersContainer,u,e)},_getActiveFilters:function(){var e=[],t=this._state.filterData;if(t.categories==undefined)return[];var n=t.categories,r,i,s;for(r in n){var o=t.categories[r],u=o.options;if(u==undefined)continue;i=0,s=u.length;for(;i<s;i++){var a=u[i];if(!a.filterActive)continue;e.push({title:a.title,categoryId:r,optionId:i})}}return e},destroy:function(){this.base()}});return f}),define("app/view-controllers/CollectionMostFiltersViewController",["require","framework/controllers/Controller","jquery"],function(e){var t=e("framework/controllers/Controller"),n=e("jquery"),r=t.extend({constructor:function(e){return this.base(e),this},_initReferences:function(e){this.base();var t=this._references;t.$mostFiltersContainer=e.find(".js-most-filters")},_initEvents:function(){this.base();var e=this._boundFunctions,t=this._references;e.onMostFilterClick=this._onMostFilterClick.bind(this),t.$mostFiltersContainer.on("click",".js-most-filter",e.onMostFilterClick)},_onMostFilterClick:function(e){e.preventDefault();var t=n(e.currentTarget),r=t.data("filter-id");this.setActiveFilter(r)},setActiveFilter:function(e){var t=this._references.$mostFiltersContainer.find(".js-most-filter"),n=t.filter(".active").data("filter-id");if(e==n){this.setActiveFilter("-_score");return}var r=t.filter("[data-filter-id="+e+"]");t.removeClass("active"),r.addClass("active"),this.trigger("orderChanged",e)},destroy:function(){this.base()}});return r}),define("app/libs/CollectionsDataFeed",["require","app/libs/DigitalGreenDataFeed","app/libs/DataModel","framework/Util"],function(e){var t=e("app/libs/DigitalGreenDataFeed"),n=e("app/libs/DataModel"),r=e("framework/Util"),i=t.extend({_filters:undefined,constructor:function(e){this.base("api/elasticSearch/"),this._filters={};var t=this._dataModel,n=t.addSubModel("collections",!0);this.addInputParam("searchString",!1,0,!0),this.addInputParam("offset",!0,0,!0),this.addInputParam("limit",!0,0,!0),this.addInputParam("filters",!1,null,!0,n),this.addInputParam("order_by",!1,null,!0,n),e!=-1&&this.addInputParamCacheClear("language__name",n)},fetch:function(e,t){e==undefined&&(e=0),t==undefined&&(t=12),this.setInputParam("offset",e*t,!0),this.setInputParam("limit",t,!0),this.base()},_processData:function(e){this.base(e);var t=this._dataModel,n=t.get("collections"),r=e.meta.limit,i=e.meta.offset/e.meta.limit;t.set("totalCount",e.meta.total_count);var s=e.objects,o=i*r,u=e.facets;return t.set("facets",e.facets),n.addSubset(s,o),s},setFilterStatus:function(e,t,n){var i=this._filters;i[e]==undefined&&(i[e]=[]);var s=i[e].indexOf(t),o=s!=-1;if(n&&o||!n&&!o)return!1;n?i[e].push(t):i[e].splice(s,1);var u=r.Object.clone(i);return this.setInputParam("filters",u),!0},clearFilters:function(){var e=!1,t=this._filters,n;for(n in t){var r=t[n],i=r.length;if(i>0){e=!0;break}}return this._filters={},e},getTotalCount:function(){return this._dataModel.get("totalCount")},getCollections:function(){var e=this.getInputParam("offset"),t=this.getInputParam("limit"),n=this._dataModel.get("collections").getSubset(e*t,t);return n?n:(this.fetch(e,t),!1)}});return i}),define("text!app/views/collection.html",[],function(){return'                            <li>\r\n                                <div class="vid-cat-selected">\r\n                                    <div class="vid-cat">\r\n                                        <a href={{url}}>\r\n                                            <img height=124  width=217  src="{{thumbnailURL}}" />\r\n                                        </a>\r\n                                        <div class="vid-flag">\r\n                                            <ul class="copy-sm copy-white h-list h-list-sm h-list-divided">\r\n                                                <li>{{videos.length}} Video{{#_plural}}s{{/_plural}}</li>\r\n                                                <li>{{_collectionStats.time}}</li>\r\n                                            </ul>\r\n                                        </div>\r\n                                        <div class="vid-cat-inner js-collection-item" data-collection-item-index="{{_index}}">\r\n                                            <div class="vid-cat-hd">\r\n                                                <h3 class="hdg-green hdg-f hdg-bold hdg-trunc">{{title}}</h3>\r\n                                            </div>\r\n                                            <div class="vid-cat-bd">\r\n                                                <p class="copy copy-sm layout-vr-tiny">{{state}} | {{language}}</p>\r\n                                                <p class="copy copy-sm">By: {{partner}}</p>\r\n                                            </div>\r\n                                            <div class="vid-cat-ft">\r\n                                                <ul class="h-list h-list-sm copy-sm copy-lt vid-cat-list">\r\n                                                    <li class="like"><span class="text-hide">Likes</span> {{_collectionStats.likes}}</li>\r\n                                                    <li class="view"><span class="text-hide">Viewed</span> {{_collectionStats.views}}</li>\r\n                                                    <li class="check"><span class="text-hide">Adopted</span> {{_collectionStats.adoptions}}</li>\r\n                                                </ul>\r\n                                            </div>\r\n                                        </div> <!-- End .vid-inner -->\r\n                                    </div> <!-- End .vid-cat -->\r\n                                </div>\r\n                            </li>'}),define("text!app/views/collection-video-drawer.html",[],function(){return'                        <li class="vidDrawer-wrapper {{_videoDrawerClasses}}">\r\n                            <div class="vidDrawer-container js-video-container">\r\n                                {{#_videoDrawers}}\r\n                                <div class="vidDrawer-wrapper-inner js-video-drawer" data-parent-collection-item-index="{{_index}}">\r\n                                    <div class="collection-video-carousel carousel-wrapper js-carousel-wrapper">\r\n                                        <div class="carousel-container js-carousel-container">\r\n                                            <ul class="carousel-list">\r\n                                                <!-- Each slide will be in a li here -->\r\n                                                {{#carouselSlides}}\r\n                                                <li>\r\n                                                    <ul class="vidDrawer clearfix">\r\n                                                        {{#videos}}\r\n                                                        <!-- Implementation Note: -->\r\n                                                        <!-- The "show-playing" and "show-progress" classes toggle display of the respective overlays -->\r\n                                                        <!-- <li class="vidDrawer-video show-playing show-progress js-vidDrawer-video"> -->\r\n                                                        <!-- <li class="vidDrawer-video show-playing js-vidDrawer-video"> -->\r\n                                                        <li class="vidDrawer-video show-progress js-vidDrawer-video">\r\n                                                        <!-- <li class="vidDrawer-video js-vidDrawer-video"> -->\r\n                                                            <div class="vidDrawer-image">\r\n                                                                <a href="{{videoURL}}">\r\n                                                                    <img src="{{thumbnailURL}}" alt="" />\r\n                                                                    <!--<div class="overlay now-playing">\r\n                                                                        Now Playing\r\n                                                                    </div>\r\n                                                                    <div class="overlay progress">\r\n                                                                        <div class="progress-inner">\r\n                                                                            <span class="amount">{{percentWatched}}</span>\r\n                                                                            <span class="percent">%</span>\r\n                                                                            <div class="watched">watched</div>\r\n                                                                        </div>\r\n                                                                    </div>-->\r\n                                                                </a>\r\n                                                            </div>\r\n                                                            <div class="vidDrawer-flag copy-white">\r\n                                                                {{_time}}\r\n                                                            </div>\r\n                                                            <div class="vidDrawer-hd copy-dk">\r\n                                                                {{_videoIndex}}. <a href="{{videoURL}}">{{title}}</a>\r\n                                                            </div>\r\n                                                        </li>\r\n                                                        {{/videos}}\r\n                                                    </ul>\r\n                                                </li>\r\n                                                {{/carouselSlides}}\r\n                                            </ul>\r\n                                        </div>\r\n                                        <div class="arrow-left carousel-previous-slide js-carousel-previous-slide">Previous</div>\r\n                                        <div class="arrow-right carousel-next-slide js-carousel-next-slide">Next</div>\r\n                                    </div>\r\n                                </div>\r\n                                {{/_videoDrawers}}\r\n                                <div class="pointer js-pointer"></div>\r\n                            </div>\r\n                        </li>'}),define("text!app/views/collection-pagination.html",[],function(){return'<ol class="pagination h-list h-list-md h-list-divided copy js-pagination">\r\n    {{#pages}}\r\n    <li><a href="#" class="{{classes}} js-pagination-item" data-page-index="{{pageIndex}}">{{pageNumber}}</a></li>\r\n    {{/pages}}\r\n</ol>'}),define("app/view-controllers/CollectionViewController",["require","framework/controllers/Controller","framework/ViewRenderer","framework/Util","jquery","libs/NCarousel/NCarousel","app/libs/CollectionsDataFeed","text!app/views/collection.html","text!app/views/collection-video-drawer.html","text!app/views/collection-pagination.html"],function(e){var t=e("framework/controllers/Controller"),n=e("framework/ViewRenderer"),r=e("framework/Util"),i=e("jquery"),s=e("libs/NCarousel/NCarousel"),o=e("app/libs/CollectionsDataFeed"),u=e("text!app/views/collection.html"),a=e("text!app/views/collection-video-drawer.html"),f=e("text!app/views/collection-pagination.html"),l=t.extend({constructor:function(e,t){return this.base(e,t),this},_initConfig:function(){this.base();var e=this._config;e.filterChangeRefreshDelay=1e3,e.containerOpenHeight=213},_initReferences:function(e,t){this.base();var n=this._references;n.dataFeed=new o(t),n.$collectionsWrapper=e,n.$loadingIndicator=e.find(".js-loading-indicator"),n.$collectionsContainer=e.find(".js-collections-container"),n.$paginationContainers=e.find(".js-pagination")},_initState:function(){this.base();var e=this._state;e.currentPageNumber=0,e.collectionsPerPage=12,e.collectionsPerRow=4,e.videoDrawerClasses="",e.videosPerDrawer=5},_initEvents:function(){this.base();var e=this._boundFunctions,t=this._references;e.onDataProcessed=this._onDataProcessed.bind(this),t.dataFeed.on("dataProcessed",e.onDataProcessed),e.onInputParamChanged=this._onInputParamChanged.bind(this),t.dataFeed.on("inputParamChanged",e.onInputParamChanged),e.onCollectionItemClick=this._onCollectionItemClick.bind(this),t.$collectionsContainer.on("click",".js-collection-item",e.onCollectionItemClick),e.onPaginationItemClick=this._onPaginationItemClick.bind(this),t.$collectionsWrapper.find(".js-pagination").on("click",".js-pagination-item",e.onPaginationItemClick)},setCollectionsPerPage:function(e){return this._state.collectionsPerPage=e,this},setCollectionsPerRow:function(e){return this._state.collectionsPerRow=e,this},setVideoDrawerClasses:function(e){return this._state.videoDrawerClasses=e,this},setVideosPerDrawer:function(e){return this._state.videosPerDrawer=e,this},getCollections:function(e,t){e==undefined?e=this._state.currentPageNumber:this._state.currentPageNumber=e,t==undefined?t=this._state.collectionsPerPage:this._state.collectionsPerPage=t;var n=this._references.dataFeed;n.setInputParam("offset",e,!0),n.setInputParam("limit",t,!0),$(".js-collections-wrapper").attr("data-searchstring")!=""&&n.setInputParam("searchString",$(".js-collections-wrapper").attr("data-searchstring"));var r=n.getCollections(),i=n.getTotalCount();if(r==0)return!1;this._updateCollectionsDisplay(r,i)},_onDataProcessed:function(){$(".js-collections-wrapper-outer").show(),this.getCollections()},_updateCollectionsDisplay:function(e,t){this._renderCollections(e),this._renderPagination(t),this._initVideoCarousels(),this._references.$loadingIndicator.hide();var n={totalCount:t};this.trigger("collectionsUpdated",n)},_initVideoCarousels:function(){var e=this._references.$collectionsContainer.find(".js-carousel-wrapper"),t=0,n=e.length;for(;t<n;t++)new s(e.eq(t),{autoPlay:!1,allowWrapping:!1})},_renderCollections:function(e,t){var i=this._state,s=i.collectionsPerRow,o=i.videoDrawerClasses,f="",l=[],c=0,h,p=e.length;for(;c<p;c++){var d=r.Object.clone(e[c],!0);d._index=c,d._collectionStats=this._getCollectionStats(d),d._plural=d.videos.length!=1,f+=n.render(u,d);for(h=0;h<d.videos.length;h++)d.videos[h]._time=r.secondsToHMSFormat(d.videos[h].duration);var v=this._prepareVideoDrawerData(d.videos);v._index=c,l.push(v);if((c+1)%s==0||c==p-1)f+=n.render(a,{_videoDrawerClasses:o,_videoDrawers:l}),l.splice(0)}this._references.$collectionsContainer.html(f)},_getCollectionStats:function(e){var t=0,n=e.videos;if(!n)throw new Error("CollectionViewController._getCollectionStats(): trying to get collection stats on an object with no videos array");var i=0,s=n.length;for(;i<s;i++){var o=n[i];t+=o.duration}var u="";e.adoptions<1e4?u=r.integerCommaFormat(e.adoptions):u=r.integerAbbreviatedFormat(e.adoptions);var a="";e.views<1e4?a=r.integerCommaFormat(e.views):a=r.integerAbbreviatedFormat(e.views);var f="";return e.likes<1e4?f=r.integerCommaFormat(e.likes):f=r.integerAbbreviatedFormat(e.likes),{time:r.secondsToHMSFormat(t),adoptions:u,views:a,likes:f}},_prepareVideoDrawerData:function(e){var t=this._state.videosPerDrawer,n=[],r=0,i=e.length,s,o;for(;r<i;r+=t){o=[];for(s=0;s<t&&s+r<i;s++){var u=e[r+s];u._videoIndex=s+r+1,o.push(u)}n.push({videos:o})}return{carouselSlides:n}},_renderPagination:function(e){var t=this._state.collectionsPerPage,r=Math.ceil(e/t),i=[],s=0;for(;s<r;s++){var o={pageIndex:s,pageNumber:s+1};s==this._state.currentPageNumber&&(o.classes="selected"),i.push(o)}var u=n.render(f,{pages:i});this._references.$paginationContainers.html(u)},_onPaginationItemClick:function(e){e.preventDefault();var t=i(e.currentTarget),n=t.data("pageIndex");if(n==this._state.currentPageNumber)return;var r=this._references.$paginationContainers.find(".js-pagination-item");r.removeClass("selected");var s=r.filter("[data-page-index="+n+"]");s.addClass("selected"),this._references.$loadingIndicator.show(),this.getCollections(n)},_onCollectionItemClick:function(e){var t=i(e.currentTarget),n=t.data("collectionItemIndex"),r=this._references.$collectionsContainer.find(".js-video-container"),s=r.find(".js-video-drawer"),o,u=0,a=s.length;for(;u<a;u++){var f=s.eq(u);if(f.data("parentCollectionItemIndex")==n){o=f;break}}var l=o.closest(".js-video-container"),c=l.find(".js-video-drawer").not(o),h=l.hasClass("open");h||(this._openVideoDrawerContainers(l),this._closeVideoDrawerContainers(r.not(l)));var p;this._references.$collectionsContainer.find(".js-video-container").each(function(){$(this).hasClass("open")&&(p=$(this).find(".js-video-drawer").filter(function(){return $(this).css("visibility")=="visible"}))});if(n==p.data("parentCollectionItemIndex"))this._hideDrawers(o),this._closeVideoDrawerContainers(l);else{this._showDrawers(o),this._hideDrawers(c);var d=l.find(".js-pointer"),v=t.offset().left,m=t.width(),g=o.offset().left,y=d.width(),b=20,w=v-g+m/2-y/2+b;h?d.animate({left:w+"px"}):d.css("left",w)}},_openVideoDrawerContainers:function(e){e.stop(!0).animate({height:this._config.containerOpenHeight+"px"}).addClass("open")},_closeVideoDrawerContainers:function(e){e.stop(!0).animate({height:"0px"}).removeClass("open")},_showDrawers:function(e){e.css({position:"relative",visibility:"visible"})},_hideDrawers:function(e){e.css({position:"",visibility:""})},setInputParam:function(e,t,n){this._references.dataFeed.setInputParam(e,t,n)},setFilterStatus:function(e,t,n){this._references.dataFeed.setFilterStatus(e,t,n)},clearFilters:function(){if(!this._references.dataFeed.clearFilters())return;this._onSearchCriteriaChanged()},_onInputParamChanged:function(){this._onSearchCriteriaChanged()},_onSearchCriteriaChanged:function(){this._references.$loadingIndicator.show(),this.getCollections(0)},destroy:function(){this.base()}});return l}),define("controllers/CollectionsController",["require","app/controllers/DigitalGreenPageController","app/view-controllers/CollectionFiltersViewController","app/view-controllers/CollectionMostFiltersViewController","app/view-controllers/CollectionViewController","jquery"],function(e){var t=e("app/controllers/DigitalGreenPageController"),n=e("app/view-controllers/CollectionFiltersViewController"),r=e("app/view-controllers/CollectionMostFiltersViewController"),i=e("app/view-controllers/CollectionViewController"),s=e("jquery"),o=t.extend({constructor:function(e,t){this.base(e,t);var n=this._references;return n.collectionViewController.setCollectionsPerPage(12).setCollectionsPerRow(3).setVideoDrawerClasses("vidDrawer-wrapper-short vidDrawer-alt-bg").setVideosPerDrawer(4),n.collectionMostFiltersViewController.setActiveFilter("-_score"),this},_initReferences:function(){this.base();var e=this._references,t=s(".js-collections-wrapper"),o=s(".js-filters-wrapper"),u=-1;e.collectionFiltersViewController=new n(o),e.collectionViewController=new i(t,u),e.collectionMostFiltersViewController=new r(t)},_initEvents:function(){this.base();var e=this._references,t=this._boundFunctions;t.onFilterChanged=this._onFilterChanged.bind(this),e.collectionFiltersViewController.on("filterChanged",t.onFilterChanged),t.onCollectionDataProcessed=this._onCollectionDataProcessed.bind(this),e.collectionViewController.on("collectionsUpdated",t.onCollectionDataProcessed),t.onOrderChanged=this._onOrderChanged.bind(this),e.collectionMostFiltersViewController.on("orderChanged",t.onOrderChanged),t.onFiltersCleared=this._onFiltersCleared.bind(this),e.collectionFiltersViewController.on("filtersCleared",t.onFiltersCleared)},_onCollectionDataProcessed:function(e){var t=this._references.collectionFiltersViewController._references.dataFeed,n=this._references.collectionViewController._references.dataFeed._state.inputParams.filters.value,r=this._references.collectionViewController._references.dataFeed._dataModel._data.facets;n&&(t.addInputParam("filters",!0,0,!0),t.setInputParam("filters",n,!0)),t.addInputParam("facets",!0,0,!0),t.setInputParam("facets",r,!0),this._references.collectionFiltersViewController._fetchFilters(),this._references.collectionFiltersViewController.updateTotalCount(e.totalCount),this._references.collectionFiltersViewController._references.filters_cleared==0&&($(".js-collections-wrapper").attr("data-partner")!="None"&&this._references.collectionFiltersViewController._setFilterStatus("partner",$(".js-collections-wrapper").attr("data-partner"),!0),$(".js-collections-wrapper").attr("data-title")!="None"&&(this._references.collectionFiltersViewController._setFilterStatus("topic",$(".js-collections-wrapper").attr("data-title"),!0),this._references.collectionFiltersViewController._setFilterStatus("subject",$(".js-collections-wrapper").attr("data-title"),!0)),$(".js-collections-wrapper").attr("data-state")!="None"&&this._references.collectionFiltersViewController._setFilterStatus("state",$(".js-collections-wrapper").attr("data-state"),!0))},_onOrderChanged:function(e){this._references.collectionViewController.setInputParam("order_by",e)},_onFilterChanged:function(e,t,n){this._references.collectionViewController.setFilterStatus(e,t,n)},_onFiltersCleared:function(){this._references.collectionFiltersViewController._references.filters_cleared=1,this._references.collectionViewController._references.dataFeed.setInputParam("filters",0,!0),this._references.collectionFiltersViewController._references.dataFeed.setInputParam("filters",0,!0),this._references.collectionViewController._references.dataFeed.setInputParam("searchString","None"),this._references.collectionViewController._references.dataFeed._fetch(),this._references.collectionViewController.clearFilters()},_getCollections:function(){this._references.collectionViewController.getCollections()},destroy:function(){this.base()}});return o});